<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phone Chat Ê®°ÊãüÂô®</title>
    <style>
        /* ‰∏ªÈ¢òÁ≥ªÁªü - ÁÆÄÁ∫¶È£éÊ†º (ÈªòËÆ§) */
        :root {
            --theme-font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            --theme-font-weight: 400;
            --theme-line-height: 1.5;
            
            --theme-button-bg: rgba(245, 245, 247, 0.8);
            --theme-button-color: #333;
            --theme-button-border: 1px solid rgba(0,0,0,0.1);
            --theme-button-radius: 12px;
            --theme-button-shadow: 0 2px 8px rgba(0,0,0,0.05);
            
            --theme-header-bg: rgba(247, 247, 247, 0.8);
            --theme-header-backdrop: blur(10px);
            
            --theme-form-bg: #ffffff;
            --theme-input-border: 1px solid #e0e0e0;
            --theme-input-radius: 12px;
            --theme-input-focus: #c0c0c0;
            
            /* Èó¥Ë∑ùÁ≥ªÁªü */
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 12px;
            --spacing-lg: 20px;
            --spacing-xl: 32px;
            
            /* Âä®ÁîªÁ≥ªÁªü */
            --transition-fast: 0.15s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;
        }

        /* ÂèØÁà±È£éÊ†º‰∏ªÈ¢ò */
        body[data-theme="cute"] {
            --theme-font-family: 'Varela Round', 'Quicksand', sans-serif;
            --theme-font-weight: 500;
            --theme-line-height: 1.6;
            
            --theme-button-bg: rgba(255, 182, 193, 0.8);
            --theme-button-color: #d44d5c;
            --theme-button-border: 1px solid rgba(255, 182, 193, 0.5);
            --theme-button-radius: 20px;
            --theme-button-shadow: 0 4px 10px rgba(255, 105, 180, 0.15);
            
            --theme-header-bg: rgba(255, 230, 240, 0.85);
            --theme-header-backdrop: blur(15px);
            
            --theme-form-bg: #fff9fc;
            --theme-input-border: 1px solid #ffccd5;
            --theme-input-radius: 20px;
            --theme-input-focus: #ffb6c1;
        }

        /* ÁªøËâ≤Ëá™ÁÑ∂‰∏ªÈ¢ò */
        body[data-theme="nature"] {
            --theme-header-bg: rgba(200, 230, 201, 0.85);
            --theme-header-backdrop: blur(10px);
        }

        /* ËìùËâ≤ÁßëÊäÄ‰∏ªÈ¢ò */
        body[data-theme="tech"] {
            --theme-header-bg: rgba(179, 229, 252, 0.85);
            --theme-header-backdrop: blur(10px);
        }

        /* Á¥´Ëâ≤Ê¢¶Âπª‰∏ªÈ¢ò */
        body[data-theme="dream"] {
            --theme-header-bg: rgba(225, 190, 231, 0.85);
            --theme-header-backdrop: blur(10px);
        }

        body {
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #ffffff;
            font-family: var(--theme-font-family, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif);
            box-sizing: border-box;
            transition: var(--transition-normal, 0.3s ease);
        }
        
        #phone-screen {
            width: 360px;
            height: 750px;
            background-color: #000;
            border-radius: 25px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 20px 50px rgba(0,0,0,0.25), inset 0 2px 4px rgba(0,0,0,0.1);
            border: none;
        }
        
        .wallpaper {
            width: 100%;
            height: 100%;
            background: #a8d4a8;
            background-size: cover;
            background-position: center;
            position: relative;
            display: flex;
            flex-direction: column;
        }
        
        #status-bar {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            padding: 6px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
            z-index: 10;
            font-size: 14px;
            box-sizing: border-box;
            pointer-events: none;
            background: transparent;
        }
        
        #status-bar-time {
            font-weight: 600;
            display: flex;
            align-items: center;
        }
        
        #status-bar-time::after {
            content: "üêæ";
            margin-left: 4px;
            font-size: 12px;
        }
        
        .battery-container {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 14px;
        }
        
        .battery-icon {
            width: 20px;
            height: 10px;
            border: 1px solid white;
            border-radius: 4px;
            position: relative;
            padding: 1px;
        }
        
        .battery-icon::after {
            content: '';
            position: absolute;
            right: -2px;
            top: 2px;
            width: 1.5px;
            height: 4px;
            background-color: white;
            border-radius: 0 1px 1px 0;
        }
        
        .battery-level {
            height: 100%;
            background-color: white;
            border-radius: 2px;
            transition: width 0.5s ease;
        }
        
        .battery-container.charging .battery-level {
            background-color: #4cd964;
            animation: charge-breath 2s infinite;
        }
        
        .battery-container.charging .battery-text {
            color: #4cd964;
        }
        
        @keyframes charge-breath {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        #clock-container {
            text-align: center;
            color: white;
            text-shadow: 0 3px 8px rgba(0,0,0,0.4);
            margin-bottom: 20px;
            flex-shrink: 0;
            margin-top: 60px;
            padding-top: 20px;
        }
        
        #main-time {
            font-size: 80px;
            font-weight: 200;
        }
        
        #main-date {
            font-size: 18px;
            font-weight: 500;
        }
        

        
        #app-grid {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            width: 100%;
            padding: 20px;
            margin-top: 40px;
        }
        
        .app-row {
            display: flex;
            justify-content: center;
            gap: 25px;
            width: 100%;
        }
        
        .app {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            color: white;
            text-shadow: 0 1px 3px rgba(0,0,0,0.5);
            font-size: 14px;
            font-weight: 500;
            text-align: center;
            text-decoration: none;
        }
        
        .app-icon {
            width: 60px;
            height: 60px;
            border-radius: 18px;
            background-color: #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 32px;
            margin-bottom: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            transition: transform 0.2s ease;
            overflow: hidden;
        }
        
        .app:active .app-icon {
            transform: scale(0.9);
        }
        
        .app-icon i {
            font-size: 30px;
            color: #333;
        }
        
        .app .label {
            color: white;
        }
        
        /* Â∫îÁî®È°µÈù¢Ê†∑Âºè */
        .app-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            display: none;
            flex-direction: column;
            color: black;
        }
        
        /* Â∫îÁî®ÁïåÈù¢Áä∂ÊÄÅÊ†è */
        .app-status-bar {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            padding: 6px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: black;
            z-index: 15;
            font-size: 14px;
            box-sizing: border-box;
            pointer-events: none;
            background: transparent;
        }
        
        .app-status-time {
            font-weight: 600;
            display: flex;
            align-items: center;
        }
        
        .app-status-time::after {
            content: "üêæ";
            margin-left: 4px;
            font-size: 12px;
        }
        
        .app-battery-container {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 14px;
        }
        
        .app-battery-icon {
            width: 20px;
            height: 10px;
            border: 1px solid black;
            border-radius: 4px;
            position: relative;
            padding: 1px;
        }
        
        .app-battery-icon::after {
            content: '';
            position: absolute;
            right: -2px;
            top: 2px;
            width: 1.5px;
            height: 4px;
            background-color: black;
            border-radius: 0 1px 1px 0;
        }
        
        .app-battery-level {
            height: 100%;
            background-color: black;
            border-radius: 2px;
            transition: width 0.5s ease;
            width: 100%;
        }
        
        .app-battery-container.charging .app-battery-level {
            background-color: #4cd964;
            animation: charge-breath 2s infinite;
        }
        
        .app-battery-container.charging .battery-text {
            color: #4cd964;
        }
        
        .app-header {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 15px;
            padding-top: 45px;
            border-bottom: 1px solid #eee;
            background-color: var(--theme-header-bg, #f8f8f8);
            backdrop-filter: var(--theme-header-backdrop, blur(10px));
            -webkit-backdrop-filter: var(--theme-header-backdrop, blur(10px));
            margin-top: 0;
            position: relative;
            z-index: 10;
            transition: background-color 0.3s ease;
        }
        
        .app-title {
            font-weight: bold;
            font-size: 18px;
            text-align: center;
            flex: 1;
            color: #000000;
        }
        
        .back-button {
            position: absolute;
            left: 20px;
            padding: 5px 10px;
            background: none;
            border: none;
            font-size: 20px;
            color: #333333;
            cursor: pointer;
            width: 30px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .app-content {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
        }
        
        /* ËÆæÁΩÆÂ∫îÁî®Ê†∑Âºè */
        .settings-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }
        
        .settings-item-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .settings-icon {
            width: 30px;
            height: 30px;
            border-radius: 6px;
            background-color: #007AFF;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
        }
        
        .settings-icon.wifi { background-color: #007AFF; }
        .settings-icon.display { background-color: #007AFF; }
        .settings-icon.wallpaper { background-color: #34C759; }
        .settings-icon.datetime { background-color: #5856D6; }
        .settings-icon.notification { background-color: #FF2D55; }
        .settings-icon.about { background-color: #8E8E93; }
        
        .settings-toggle {
            position: relative;
            width: 50px;
            height: 30px;
        }
        
        .settings-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .settings-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .settings-slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .settings-slider {
            background-color: #34C759;
        }
        
        input:checked + .settings-slider:before {
            transform: translateX(20px);
        }
        
        /* APIËÆæÁΩÆÁïåÈù¢ */
        .api-settings {
            padding: 15px;
        }
        
        .api-form-group {
            margin-bottom: 15px;
        }
        
        .api-form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .api-form-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .api-form-select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .api-form-range {
            width: 100%;
        }
        
        .api-form-submit {
            background-color: #007AFF;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
        }
        
        /* Êó†Á∫øÂ±ÄÂüüÁΩëËÆæÁΩÆ */
        .wifi-settings {
            padding: 15px;
        }
        
        .wifi-network {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }
        
        .wifi-network:last-child {
            border-bottom: none;
        }
        
        .wifi-network-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .wifi-icon {
            width: 24px;
            height: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .wifi-strength {
            display: flex;
            align-items: center;
            gap: 2px;
        }
        
        .wifi-strength-bar {
            width: 3px;
            height: 10px;
            background-color: #ccc;
            border-radius: 1px;
        }
        
        .wifi-strength-bar.active {
            background-color: #007AFF;
        }
        
        /* ‰∏ªÈ¢òÈÄâÊã©Âô®Ê†∑Âºè */
        .theme-option {
            display: flex;
            align-items: center;
            padding: 15px 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        .theme-option:hover {
            background-color: #f5f5f5;
        }
        
        .theme-option:last-child {
            border-bottom: none;
        }
        
        .theme-preview {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            margin-right: 15px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .theme-preview-header {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(5px);
        }
        
        .theme-preview-content {
            position: absolute;
            bottom: 8px;
            left: 8px;
            right: 8px;
            height: 25px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 4px;
        }
        
        .theme-info {
            flex: 1;
        }
        
        .theme-name {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 4px;
        }
        
        .theme-description {
            font-size: 13px;
            color: #666;
        }
        
        /* ËÅäÂ§©ÂØπËØùÊ°Ü */
        .chat-dialog {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 10px;
            position: relative;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 10px;
            padding-bottom: 60px;
        }
        
        .message-container {
            display: flex;
            margin-bottom: 15px;
            align-items: flex-start;
        }
        
        .message-container.received {
            justify-content: flex-start;
        }
        
        .message-container.sent {
            justify-content: flex-end;
        }
        
        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #ddd;
            margin-right: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            background-size: cover;
            background-position: center;
            flex-shrink: 0;
        }
        
        .message-bubble {
            max-width: 70%;
            padding: 10px 15px;
            border-radius: 18px;
            position: relative;
            word-wrap: break-word;
        }
        
        .received .message-bubble {
            background-color: #f0f0f0;
            margin-left: 10px;
        }
        
        .sent .message-bubble {
            background-color: #007AFF;
            color: white;
            margin-right: 10px;
        }
        
        .message-image {
            max-width: 200px;
            max-height: 200px;
            border-radius: 10px;
            margin-top: 5px;
            cursor: pointer;
        }
        
        .chat-input-area {
            display: flex;
            gap: 10px;
            padding: 10px;
            background-color: #f8f8f8;
            border-top: 1px solid #eee;
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
        }
        
        .chat-input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 20px;
        }
        
        .send-button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #007AFF;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            border: none;
            cursor: pointer;
        }
        
        .image-upload-button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #f0f0f0;
            color: #007AFF;
            display: flex;
            justify-content: center;
            align-items: center;
            border: none;
            cursor: pointer;
        }
        
        /* ÂæÆ‰ø°ËÅäÂ§©ÁïåÈù¢ */
        #chat-screen {
            display: none;
            flex-direction: column;
        }
        
        .wechat-tabs {
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            border-top: 1px solid #eee;
            background-color: #f8f8f8;
        }
        
        .wechat-tab {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #888;
            font-size: 12px;
            cursor: pointer;
        }
        
        .wechat-tab.active {
            color: #07C160;
        }
        
        .wechat-tab i {
            font-size: 24px;
            margin-bottom: 3px;
        }
        
        /* Ê∂àÊÅØÂàóË°® */
        .message-list {
            flex: 1;
            overflow-y: auto;
        }
        
        .message-item {
            display: flex;
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }
        
        .message-content {
            flex: 1;
        }
        
        .message-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .message-preview {
            color: #888;
            font-size: 14px;
        }
        
        .message-time {
            font-size: 12px;
            color: #aaa;
        }
        
        /* ÈÄöËÆØÂΩï */
        .contact-list {
            flex: 1;
            overflow-y: auto;
        }
        
        .contact-section {
            margin-bottom: 15px;
        }
        
        .section-title {
            padding: 5px 15px;
            background-color: #f5f5f5;
            color: #888;
            font-size: 14px;
        }
        
        .contact-item {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }
        
        /* ÊúãÂèãÂúà */
        .moment-list {
            flex: 1;
            overflow-y: auto;
        }
        
        .moment-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .moment-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .moment-name {
            font-weight: bold;
        }
        
        .moment-content {
            margin-bottom: 10px;
        }
        
        .moment-images {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            margin-bottom: 10px;
        }
        
        .moment-image {
            aspect-ratio: 1;
            background-color: #eee;
        }
        
        .moment-actions {
            display: flex;
            justify-content: space-between;
            color: #888;
            font-size: 14px;
        }
        
        /* ‰∏™‰∫∫È°µÈù¢ */
        .profile-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 30px 0;
            background-color: #f8f8f8;
        }
        
        .profile-name {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 5px;
        }
        
        .profile-id {
            color: #888;
            font-size: 14px;
        }
        
        .profile-menu {
            margin-top: 20px;
        }
        
        .menu-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .menu-item-left {
            display: flex;
            align-items: center;
        }
        
        .menu-icon {
            width: 30px;
            height: 30px;
            border-radius: 5px;
            background-color: #07C160;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 10px;
        }
        
        /* ‰∫∫Áâ©Â∫îÁî® */
        .character-list {
            flex: 1;
            overflow-y: auto;
            padding-bottom: 60px;
        }
        
        .character-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }
        
        .character-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #ddd;
            margin-right: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            background-size: cover;
            background-position: center;
        }
        
        .character-info {
            flex: 1;
        }
        
        .character-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .character-bio {
            color: #888;
            font-size: 14px;
        }
        
        .add-character-header {
            position: absolute;
            right: 15px;
            top: 15px;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #007AFF;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 16px;
            cursor: pointer;
        }
        
        /* ËßíËâ≤ÁºñËæëË°®Âçï */
        .character-form {
            padding: 15px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .form-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .form-textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            min-height: 100px;
            resize: vertical;
        }
        
        .form-submit {
            background-color: #007AFF;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .avatar-upload {
            margin-bottom: 15px;
        }
        
        .avatar-preview {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background-color: #eee;
            margin: 10px auto;
            background-size: cover;
            background-position: center;
            position: relative;
            overflow: hidden;
        }
        
        .avatar-preview-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 40px;
            font-weight: bold;
            color: white;
        }
        
        .upload-button {
            display: block;
            width: 100%;
            padding: 8px;
            background-color: #007AFF;
            color: white;
            border: none;
            border-radius: 5px;
            text-align: center;
            cursor: pointer;
            margin-top: 10px;
        }
        
        /* ÂæÆÂçöÁïåÈù¢ */
        .weibo-post {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .weibo-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .weibo-user {
            flex: 1;
        }
        
        .weibo-name {
            font-weight: bold;
        }
        
        .weibo-time {
            color: #888;
            font-size: 12px;
        }
        
        .weibo-content {
            margin-bottom: 10px;
        }
        
        .weibo-images {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            margin-bottom: 10px;
        }
        
        .weibo-image {
            aspect-ratio: 1;
            background-color: #eee;
        }
        
        .weibo-actions {
            display: flex;
            justify-content: space-around;
            color: #888;
        }
        
        .weibo-action {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* Èü≥‰πêÂ∫îÁî®Ê†∑Âºè */
        .music-player {
            padding: 20px;
            text-align: center;
        }
        
        .now-playing {
            margin-bottom: 30px;
        }
        
        .album-cover {
            width: 200px;
            height: 200px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            color: white;
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
        }
        
        .song-info {
            margin-bottom: 20px;
        }
        
        .song-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .artist-name {
            font-size: 16px;
            color: #666;
        }
        
        .progress-container {
            margin-bottom: 30px;
        }
        
        .progress-bar {
            width: 100%;
            height: 4px;
            background-color: #e0e0e0;
            border-radius: 2px;
            margin-bottom: 10px;
            position: relative;
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 2px;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .time-info {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #666;
        }
        
        .music-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .control-btn {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-size: 20px;
            cursor: pointer;
            transition: transform 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .control-btn:hover {
            transform: scale(1.1);
        }
        
        .control-btn.play-pause {
            width: 60px;
            height: 60px;
            font-size: 24px;
        }
        
        .playlist-section, .character-listening {
            text-align: left;
            margin-bottom: 30px;
        }
        
        .section-header, .listening-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .section-header h3, .listening-header h3 {
            margin: 0;
            font-size: 18px;
        }
        
        .add-music-btn, .invite-character-btn {
            width: 30px;
            height: 30px;
            border: none;
            border-radius: 50%;
            background-color: #007AFF;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .playlist {
            background-color: #f8f8f8;
            border-radius: 10px;
            padding: 15px;
            min-height: 100px;
        }
        
        .playlist-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }
        
        .playlist-item:last-child {
            border-bottom: none;
        }
        
        .playlist-item:hover {
            background-color: #f0f0f0;
            border-radius: 5px;
        }
        
        .listening-characters {
            background-color: #f8f8f8;
            border-radius: 10px;
            padding: 15px;
            min-height: 80px;
        }
        
        .character-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
        }
        
        .character-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .character-name {
            flex: 1;
        }
        
        .listening-status {
            font-size: 12px;
            color: #666;
        }
        
        /* Ë¥≠Áâ©ÁïåÈù¢ */
        .product-list {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            padding: 15px;
        }
        
        .product-item {
            background-color: #f9f9f9;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .product-image {
            width: 100%;
            aspect-ratio: 1;
            background-color: #eee;
        }
        
        .product-info {
            padding: 10px;
        }
        
        .product-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .product-price {
            color: #FF2D55;
            font-weight: bold;
        }
        
        .product-seller {
            display: flex;
            align-items: center;
            margin-top: 5px;
            font-size: 12px;
            color: #888;
        }
        
        /* ÊµèËßàÂô®ÁïåÈù¢ */
        .browser-toolbar {
            display: flex;
            padding: 10px;
            background-color: #f8f8f8;
            border-bottom: 1px solid #ddd;
        }
        
        .browser-url-bar {
            flex: 1;
            padding: 8px 15px;
            border-radius: 20px;
            border: 1px solid #ddd;
            background-color: white;
        }
        
        .browser-content {
            border: none;
            width: 100%;
            height: 100%;
        }
        
        /* Áõ∏Êú∫ÁïåÈù¢ */
        .camera-view {
            flex: 1;
            background-color: #FFEEF2; /* Á≤âÁôΩËâ≤ËÉåÊôØ */
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #888;
            font-size: 18px;
        }
        
        .camera-controls {
            position: absolute;
            bottom: 20px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
        }
        
        .capture-button {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: white;
            border: 3px solid #ddd;
            cursor: pointer;
        }
        
        /* Áõ∏ÂÜåÁïåÈù¢ */
        .album-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2px;
        }
        
        .album-item {
            aspect-ratio: 1;
            background-color: #FFEEF2; /* Á≤âÁôΩËâ≤ËÉåÊôØ */
            background-size: cover;
            background-position: center;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 10px;
            font-size: 12px;
            color: #333;
            word-break: break-word;
            overflow: hidden;
        }
        
        .album-item::after {
            content: attr(data-description);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            text-align: center;
        }
        
        .album-item::before {
            content: attr(data-time);
            position: absolute;
            bottom: 5px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 10px;
            color: #666;
        }
        
        /* ÁÖßÁâáËØ¶ÊÉÖ */
        .photo-detail {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .photo-image {
            flex: 1;
            background-color: #FFEEF2; /* Á≤âÁôΩËâ≤ËÉåÊôØ */
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .photo-description {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            text-align: center;
            font-size: 16px;
            color: #333;
            background-color: rgba(255, 255, 255, 0.7);
            padding: 10px;
            border-radius: 5px;
        }
        
        .photo-info {
            padding: 15px;
            background-color: white;
            border-top: 1px solid #eee;
        }
        
        .photo-time, .photo-location {
            color: #888;
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        /* Â£ÅÁ∫∏ËÆæÁΩÆ */
        .wallpaper-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            padding: 15px;
        }
        
        .wallpaper-option {
            aspect-ratio: 1;
            border-radius: 10px;
            background-size: cover;
            background-position: center;
            border: 2px solid transparent;
            cursor: pointer;
        }
        
        .wallpaper-option.selected {
            border-color: #007AFF;
        }
        
        /* ÂõæÊ†áËÆæÁΩÆ */
        .icon-options {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            padding: 15px;
        }
        
        .icon-option {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .icon-preview {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            background-color: #007AFF;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 30px;
            margin-bottom: 5px;
            background-size: cover;
            background-position: center;
        }
        
        /* ËÅäÂ§©ËÆæÁΩÆËèúÂçï */
        .chat-menu {
            position: absolute;
            top: 60px;
            right: 15px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
            width: 200px;
            overflow: hidden;
            display: none;
        }
        
        .chat-menu-item {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }
        
        .chat-menu-item:last-child {
            border-bottom: none;
        }
        
        /* È¢úËâ≤ÈÄâÊã©Âô® */
        .color-picker {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            padding: 15px;
        }
        
        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid transparent;
            cursor: pointer;
        }
        
        .color-option.selected {
            border-color: #000;
        }
        
        /* ÈÄèÊòéÂ∫¶ÊªëÂùó */
        .opacity-slider {
            width: 100%;
            padding: 0 15px;
            margin-top: 10px;
        }
        
        /* Êñ∞Âª∫ËÅîÁ≥ª‰∫∫Ê®°ÊÄÅÊ°Ü */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            width: 80%;
            max-width: 400px;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .modal-header {
            padding: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-weight: bold;
            font-size: 18px;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
        }
        
        .modal-body {
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .modal-footer {
            padding: 15px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .modal-button {
            padding: 8px 15px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
        }
        
        .modal-primary {
            background-color: #007AFF;
            color: white;
        }
        
        .modal-secondary {
            background-color: #eee;
        }
        
        /* Ê∂àÊÅØÊìç‰ΩúËèúÂçï */
        .message-menu {
            position: absolute;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            z-index: 100;
            display: none;
        }
        
        .message-menu-item {
            padding: 8px 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }
        
        .message-menu-item:last-child {
            border-bottom: none;
        }
        
        /* ÂÖ≥‰∫éÊàë‰ª¨È°µÈù¢ */
        .about-content {
            padding: 20px;
            text-align: center;
        }
        
        .about-title {
            font-size: 24px;
            margin-bottom: 20px;
        }
        
        .about-version {
            color: #888;
            margin-bottom: 30px;
        }
        
        .about-author {
            margin-top: 30px;
            font-style: italic;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div id="phone-screen">
        <div class="wallpaper">
            <!-- Áä∂ÊÄÅÊ†è -->
            <div id="status-bar">
                <span id="status-bar-time">14:25</span>
                <div id="status-bar-battery" class="battery-container">
                    <span class="battery-text">‚ô°</span>
                    <div class="battery-icon">
                        <div class="battery-level"></div>
                    </div>
                </div>
            </div>
            
            <!-- Êó∂ÈíüÂÆπÂô® -->
            <div id="clock-container">
                <div id="main-time">14:25</div>
                <div id="main-date">12Êúà18Êó• ÊòüÊúü‰∏Ä</div>
            </div>
                
                <!-- Â∫îÁî®ÂõæÊ†á -->
                <div id="app-grid">
                    <div class="app-row">
                        <a href="#" class="app" onclick="showApp('chat-screen')">
                            <div class="app-icon">
                                <img src="https://i.postimg.cc/dVSd9QBz/IMG-3063.jpg" alt="Chat" style="width: 100%; height: 100%; object-fit: cover; border-radius: 18px;">
                            </div>
                            <span>Chat</span>
                        </a>
                        <a href="#" class="app" onclick="showApp('worldbook-screen')">
                            <div class="app-icon">
                                <img src="https://i.postimg.cc/Xqz3zPz7/IMG-3080.jpg" alt="‰∏ñÁïå‰π¶" style="width: 100%; height: 100%; object-fit: cover; border-radius: 18px;">
                            </div>
                            <span>‰∏ñÁïå‰π¶</span>
                        </a>
                        <a href="#" class="app" onclick="showApp('settings-screen')">
                            <div class="app-icon">
                                <img src="https://i.postimg.cc/764L3jpF/IMG-3079.jpg" alt="ËÆæÁΩÆ" style="width: 100%; height: 100%; object-fit: cover; border-radius: 18px;">
                            </div>
                            <span>ËÆæÁΩÆ</span>
                        </a>
                    </div>
                    <div class="app-row">
                        <a href="#" class="app" onclick="showApp('album-screen')">
                            <div class="app-icon">
                                <img src="https://i.postimg.cc/DyS7X2SW/IMG-3081.jpg" alt="Áõ∏ÂÜå" style="width: 100%; height: 100%; object-fit: cover; border-radius: 18px;">
                            </div>
                            <span>Áõ∏ÂÜå</span>
                        </a>
                        <a href="#" class="app" onclick="showApp('music-screen')">
                            <div class="app-icon">
                                <i class="fas fa-music"></i>
                            </div>
                            <span>Èü≥‰πê</span>
                        </a>
                        <a href="#" class="app" onclick="showApp('weibo-screen')">
                            <div class="app-icon">
                                <img src="https://i.postimg.cc/8cHffTcX/IMG-3064.jpg" alt="ÂæÆÂçö" style="width: 100%; height: 100%; object-fit: cover; border-radius: 18px;">
                            </div>
                            <span>ÂæÆÂçö</span>
                        </a>
                    </div>
                </div>

                
                <!-- ÂæÆ‰ø°ÁïåÈù¢ -->
                <div id="chat-screen" class="app-screen">
                    <div class="app-status-bar">
                        <div class="app-status-time"></div>
                        <div class="app-battery-container">
                            <span class="battery-text">‚ô°</span>
                            <div class="app-battery-icon">
                                <div class="app-battery-level"></div>
                            </div>
                        </div>
                    </div>
                    <div class="app-header">
                        <button class="back-button" onclick="hideApp('chat-screen')">‚Äπ</button>
                        <div class="app-title">üí¨</div>
                        <div class="chat-header-actions">
                            <div id="add-contact-btn" style="display: none; position: absolute; right: 20px; width: 30px; height: 30px; cursor: pointer; justify-content: center; align-items: center; font-size: 20px; color: #333333;" onclick="showCharacterForm()">
                                <i class="fas fa-plus"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="app-content" id="wechat-content">
                        <!-- ÈªòËÆ§ÊòæÁ§∫Ê∂àÊÅØÂàóË°® -->
                        <div class="message-list" id="message-list">
                            <!-- Ê∂àÊÅØÂàóË°®Â∞ÜÈÄöËøáJSÂä®ÊÄÅÁîüÊàê -->
                        </div>
                        
                        <!-- ÈÄöËÆØÂΩï -->
                        <div class="contact-list" id="contact-list" style="display: none;">
                            <div class="contact-section">
                                <div class="section-title">ÊàëÁöÑËÅîÁ≥ª‰∫∫</div>
                                <!-- ËÅîÁ≥ª‰∫∫ÂàóË°®Â∞ÜÈÄöËøáJSÂä®ÊÄÅÁîüÊàê -->
                            </div>

                        </div>
                        
                        <!-- ÊúãÂèãÂúà -->
                        <div class="moment-list" id="moment-list" style="display: none;">
                            <div class="moment-item">
                                <div class="moment-header">
                                    <div class="moment-avatar"></div>
                                    <div class="moment-name">Âº†‰∏â</div>
                                </div>
                                <div class="moment-content">
                                    ‰ªäÂ§©ÁöÑÂ§©Ê∞îÁúüÂ•ΩÔºåÂá∫ÂéªËµ∞Ëµ∞ÂøÉÊÉÖÈÉΩÂèòÂ•Ω‰∫ÜÔºÅ
                                </div>
                                <div class="moment-images">
                                    <div class="moment-image"></div>
                                </div>
                                <div class="moment-actions">
                                    <span>10ÂàÜÈíüÂâç</span>
                                    <span><i class="far fa-heart"></i> 12 <i class="far fa-comment"></i> 3</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ÊàëÁöÑÈ°µÈù¢ -->
                        <div class="profile-page" id="profile-page" style="display: none;">
                            <div class="profile-header">
                                <div class="profile-avatar"></div>
                                <div class="profile-name">ÊàëÁöÑÂêçÂ≠ó</div>
                                <div class="profile-id">ÂæÆ‰ø°Âè∑: mywechatid</div>
                            </div>
                            <div class="profile-menu">
                                <div class="menu-item">
                                    <div class="menu-item-left">
                                        <div class="menu-icon">
                                            <i class="fas fa-wallet"></i>
                                        </div>
                                        <div>ÊîØ‰ªò</div>
                                    </div>
                                    <i class="fas fa-chevron-right"></i>
                                </div>
                                <div class="menu-item">
                                    <div class="menu-item-left">
                                        <div class="menu-icon" style="background-color: #FFBE00;">
                                            <i class="fas fa-star"></i>
                                        </div>
                                        <div>Êî∂Ëóè</div>
                                    </div>
                                    <i class="fas fa-chevron-right"></i>
                                </div>
                                <div class="menu-item">
                                    <div class="menu-item-left">
                                        <div class="menu-icon" style="background-color: #07C160;">
                                            <i class="fas fa-image"></i>
                                        </div>
                                        <div>Áõ∏ÂÜå</div>
                                    </div>
                                    <i class="fas fa-chevron-right"></i>
                                </div>
                                <div class="menu-item" onclick="showApp('chat-settings-screen')">
                                    <div class="menu-item-left">
                                        <div class="menu-icon" style="background-color: #007AFF;">
                                            <i class="fas fa-cog"></i>
                                        </div>
                                        <div>ËÆæÁΩÆ</div>
                                    </div>
                                    <i class="fas fa-chevron-right"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="wechat-tabs">
                        <div class="wechat-tab active" onclick="switchWechatTab('message-list')">
                            <i class="fas fa-comment-alt"></i>
                            <span>Ê∂àÊÅØ</span>
                        </div>
                        <div class="wechat-tab" onclick="switchWechatTab('contact-list')">
                            <i class="fas fa-address-book"></i>
                            <span>ÈÄöËÆØÂΩï</span>
                        </div>
                        <div class="wechat-tab" onclick="switchWechatTab('moment-list')">
                            <i class="fas fa-camera"></i>
                            <span>Âä®ÊÄÅ</span>
                        </div>
                        <div class="wechat-tab" onclick="switchWechatTab('profile-page')">
                            <i class="fas fa-user"></i>
                            <span>Êàë</span>
                        </div>
                    </div>
                </div>
                
                <!-- ÂæÆÂçöÁïåÈù¢ -->
                <div id="weibo-screen" class="app-screen">
                    <div class="app-status-bar">
                        <div class="app-status-time"></div>
                        <div class="app-battery-container">
                            <span class="battery-text">‚ô°</span>
                            <div class="app-battery-icon">
                                <div class="app-battery-level"></div>
                            </div>
                        </div>
                    </div>
                    <div class="app-header">
                        <button class="back-button" onclick="hideApp('weibo-screen')">‚Äπ</button>
                        <div class="app-title">ÂæÆÂçö</div>
                    </div>
                    <div class="app-content">
                        <div class="weibo-post">
                            <div class="weibo-header">
                                <div class="weibo-avatar"></div>
                                <div class="weibo-user">
                                    <div class="weibo-name">Âº†‰∏â</div>
                                    <div class="weibo-time">10ÂàÜÈíüÂâç</div>
                                </div>
                            </div>
                            <div class="weibo-content">
                                ‰ªäÂ§©Â§©Ê∞îÁúüÂ•ΩÔºåÂá∫ÂéªËµ∞Ëµ∞ÂøÉÊÉÖÈÉΩÂèòÂ•Ω‰∫ÜÔºÅ
                            </div>
                            <div class="weibo-images">
                                <div class="weibo-image"></div>
                            </div>
                            <div class="weibo-actions">
                                <div class="weibo-action">
                                    <i class="far fa-comment"></i>
                                    <span>ËØÑËÆ∫</span>
                                </div>
                                <div class="weibo-action">
                                    <i class="fas fa-retweet"></i>
                                    <span>ËΩ¨Âèë</span>
                                </div>
                                <div class="weibo-action">
                                    <i class="far fa-heart"></i>
                                    <span>ÁÇπËµû</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ‰∏ñÁïå‰π¶ÁïåÈù¢ -->
                <div id="worldbook-screen" class="app-screen">
                    <div class="app-status-bar">
                        <div class="app-status-time"></div>
                        <div class="app-battery-container">
                            <span class="battery-text">‚ô°</span>
                            <div class="app-battery-icon">
                                <div class="app-battery-level"></div>
                            </div>
                        </div>
                    </div>
                    <div class="app-header">
                        <button class="back-button" onclick="hideApp('worldbook-screen')">‚Äπ</button>
                        <div class="app-title">‰∏ñÁïå‰π¶</div>
                        <div class="add-worldbook-btn" onclick="showWorldbookForm()" style="position: absolute; right: 20px; width: 30px; height: 30px; cursor: pointer; display: flex; justify-content: center; align-items: center; font-size: 20px; color: #333333;">
                            <i class="fas fa-plus"></i>
                        </div>
                    </div>
                    <div class="app-content">
                        <div class="worldbook-list" id="worldbook-list">
                            <!-- ‰∏ñÁïå‰π¶ÂàóË°®Â∞ÜÈÄöËøáJSÂä®ÊÄÅÁîüÊàê -->
                        </div>
                    </div>
                </div>
                
                <!-- ‰∏ñÁïå‰π¶ÁºñËæëË°®Âçï -->
                <div id="worldbook-form-screen" class="app-screen">
                    <div class="app-header">
                        <button class="back-button" onclick="hideWorldbookForm()">‚Äπ</button>
                        <div class="app-title" id="worldbook-form-title">Êñ∞Âª∫‰∏ñÁïå‰π¶</div>
                        <button class="save-worldbook-btn" onclick="saveWorldbook()" style="position: absolute; right: 20px; padding: 5px 10px; background: none; border: none; font-size: 16px; color: #333333; cursor: pointer;">‰øùÂ≠ò</button>
                    </div>
                    <div class="app-content">
                        <div class="worldbook-form">
                            <div class="form-group">
                                <label class="form-label">Ê†áÈ¢ò</label>
                                <input type="text" class="form-input" id="worldbook-title" placeholder="ËæìÂÖ•‰∏ñÁïå‰π¶Ê†áÈ¢ò">
                            </div>
                            <div class="form-group">
                                <label class="form-label">ÂÜÖÂÆπ</label>
                                <textarea class="form-textarea" id="worldbook-content" placeholder="ËæìÂÖ•‰∏ñÁïå‰π¶ÂÜÖÂÆπ..." style="height: 400px;"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Èü≥‰πêÂ∫îÁî®ÁïåÈù¢ -->
                <div id="music-screen" class="app-screen">
                    <div class="app-status-bar">
                        <div class="app-status-time"></div>
                        <div class="app-battery-container">
                            <span class="battery-text">‚ô°</span>
                            <div class="app-battery-icon">
                                <div class="app-battery-level"></div>
                            </div>
                        </div>
                    </div>
                    <div class="app-header">
                        <button class="back-button" onclick="hideApp('music-screen')">‚Äπ</button>
                        <div class="app-title">Èü≥‰πê</div>
                    </div>
                    <div class="app-content">
                        <div class="music-player">
                            <div class="now-playing">
                                <div class="album-cover" id="album-cover">
                                    <i class="fas fa-music"></i>
                                </div>
                                <div class="song-info">
                                    <div class="song-title" id="song-title">ÈÄâÊã©‰∏ÄÈ¶ñÊ≠åÊõ≤</div>
                                    <div class="artist-name" id="artist-name">Êú™Áü•Ëâ∫ÊúØÂÆ∂</div>
                                </div>
                            </div>
                            
                            <div class="progress-container">
                                <div class="progress-bar">
                                    <div class="progress" id="progress"></div>
                                </div>
                                <div class="time-info">
                                    <span id="current-time">0:00</span>
                                    <span id="total-time">0:00</span>
                                </div>
                            </div>
                            
                            <div class="music-controls">
                                <button class="control-btn" onclick="previousSong()">
                                    <i class="fas fa-step-backward"></i>
                                </button>
                                <button class="control-btn play-pause" id="play-pause-btn" onclick="togglePlayPause()">
                                    <i class="fas fa-play"></i>
                                </button>
                                <button class="control-btn" onclick="nextSong()">
                                    <i class="fas fa-step-forward"></i>
                                </button>
                            </div>
                            
                            <div class="playlist-section">
                                <div class="section-header">
                                    <h3>Êí≠ÊîæÂàóË°®</h3>
                                    <button class="add-music-btn" onclick="addMusicToPlaylist()">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                <div class="playlist" id="playlist">
                                    <!-- Êí≠ÊîæÂàóË°®Â∞ÜÈÄöËøáJSÂä®ÊÄÅÁîüÊàê -->
                                </div>
                            </div>
                            
                            <div class="character-listening">
                                <div class="listening-header">
                                    <h3>‰∏ÄËµ∑Âê¨Ê≠åÁöÑËßíËâ≤</h3>
                                    <button class="invite-character-btn" onclick="inviteCharacterToListen()">
                                        <i class="fas fa-user-plus"></i>
                                    </button>
                                </div>
                                <div class="listening-characters" id="listening-characters">
                                    <!-- Âê¨Ê≠åËßíËâ≤Â∞ÜÈÄöËøáJSÂä®ÊÄÅÁîüÊàê -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ‰∫∫Áâ©ÁºñËæëË°®Âçï -->
                <div id="character-form-screen" class="app-screen">
                    <div class="app-header">
                        <button class="back-button" onclick="hideCharacterForm()">‚Äπ</button>
                        <div class="app-title" id="character-form-title">Êñ∞Âª∫‰∫∫Áâ©</div>
                    </div>
                    <div class="app-content">
                        <div class="character-form">
                            <div class="form-group avatar-upload">
                                <label class="form-label">Â§¥ÂÉè</label>
                                <div class="avatar-preview" id="avatar-preview">
                                    <div class="avatar-preview-text" id="avatar-preview-text">A</div>
                                </div>
                                <input type="file" id="avatar-upload" accept="image/*" style="display: none;">
                                <button class="upload-button" onclick="document.getElementById('avatar-upload').click()">‰∏ä‰º†Â§¥ÂÉè</button>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">ÂßìÂêç</label>
                                <input type="text" class="form-input" id="character-name" placeholder="ËæìÂÖ•ÂßìÂêç">
                            </div>
                            <div class="form-group">
                                <label class="form-label">‰∫∫ËÆæ</label>
                                <textarea class="form-textarea" id="character-bio" placeholder="ËæìÂÖ•‰∫∫Áâ©ËÆæÂÆö"></textarea>
                            </div>
                            <button class="form-submit" onclick="saveCharacter()">‰øùÂ≠ò</button>
                        </div>
                    </div>
                </div>
                
                <!-- APIËÅäÂ§©ÁïåÈù¢ -->
                <div id="api-chat-screen" class="app-screen">
                    <div class="app-header">
                        <button class="back-button" onclick="hideApp('api-chat-screen')">‚Äπ</button>
                        <div class="app-title" id="api-chat-title">AIËÅäÂ§©</div>
                        <div class="chat-menu-button" onclick="toggleChatMenu()" style="position: absolute; right: 20px; width: 30px; height: 30px; display: flex; justify-content: center; align-items: center; cursor: pointer; color: #333333;">
                            <i class="fas fa-ellipsis-v"></i>
                        </div>
                        <div class="chat-menu" id="chat-menu">
                            <div class="chat-menu-item" onclick="changeCharacterAvatar()">‰øÆÊîπÂ§¥ÂÉè</div>
                            <div class="chat-menu-item" onclick="changeCharacterNickname()">‰øÆÊîπÂ§áÊ≥®</div>
                            <div class="chat-menu-item" onclick="searchChatContent()">Êü•ÊâæËÅäÂ§©ÂÜÖÂÆπ</div>
                            <div class="chat-menu-item" onclick="pinChat()">ÁΩÆÈ°∂ËÅäÂ§©</div>
                            <div class="chat-menu-item" onclick="exportChatHistory()">ÂØºÂá∫ËÅäÂ§©ËÆ∞ÂΩï</div>
                            <div class="chat-menu-item" onclick="changeChatBackground()">ËÆæÁΩÆËÅäÂ§©ËÉåÊôØ</div>
                            <div class="chat-menu-item" onclick="changeTheirBubbleColor()">ËÆæÁΩÆÂØπÊñπÊ∞îÊ≥°È¢úËâ≤</div>
                            <div class="chat-menu-item" onclick="changeMyBubbleColor()">ËÆæÁΩÆÊàëÊñπÊ∞îÊ≥°È¢úËâ≤</div>
                        </div>
                    </div>
                    <div class="app-content">
                        <div class="chat-dialog">
                            <div class="chat-messages" id="api-chat-messages">
                                <!-- ËÅäÂ§©Ê∂àÊÅØÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÁîüÊàê -->
                            </div>
                            <div class="chat-input-area">
                                <button class="image-upload-button" onclick="uploadImage()">
                                    <i class="fas fa-image"></i>
                                </button>
                                <input type="text" class="chat-input" id="api-chat-input" placeholder="ËæìÂÖ•Ê∂àÊÅØ...">
                                <button class="send-button" onclick="sendApiMessage()">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                                <input type="file" id="image-upload" accept="image/*" style="display: none;">
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ÊµèËßàÂô®ÁïåÈù¢ -->
                <div id="browser-screen" class="app-screen">
                    <div class="app-header">
                        <button class="back-button" onclick="hideApp('browser-screen')">‚Äπ</button>
                        <div class="app-title">ÊµèËßàÂô®</div>
                    </div>
                    <div class="app-content" style="padding: 0; display: flex; flex-direction: column;">
                        <div class="browser-toolbar">
                            <input type="text" class="browser-url-bar" id="browser-url" value="https://www.baidu.com">
                            <button onclick="loadUrl()">ÂâçÂæÄ</button>
                        </div>
                        <iframe class="browser-content" id="browser-frame" src="https://www.baidu.com"></iframe>
                    </div>
                </div>
                
                <!-- Áõ∏Êú∫ÁïåÈù¢ -->
                <div id="camera-screen" class="app-screen">
                    <div class="app-header">
                        <button class="back-button" onclick="hideApp('camera-screen')">‚Äπ</button>
                        <div class="app-title">Áõ∏Êú∫</div>
                    </div>
                    <div class="app-content" style="padding: 0; display: flex; flex-direction: column;">
                        <div class="camera-view" id="camera-view">
                            <div>Áõ∏Êú∫È¢ÑËßà</div>
                        </div>
                        <div class="camera-controls">
                            <button class="capture-button" onclick="capturePhoto()"></button>
                        </div>
                    </div>
                </div>
                
                <!-- Áõ∏ÂÜåÁïåÈù¢ -->
                <div id="album-screen" class="app-screen">
                    <div class="app-header">
                        <button class="back-button" onclick="hideApp('album-screen')">‚Äπ</button>
                        <div class="app-title">Áõ∏ÂÜå</div>
                    </div>
                    <div class="app-content" style="padding: 0;">
                        <div class="album-grid" id="album-grid">
                            <!-- Áõ∏ÂÜåÂÜÖÂÆπÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÁîüÊàê -->
                        </div>
                    </div>
                </div>
                
                <!-- ÁÖßÁâáËØ¶ÊÉÖ -->
                <div id="photo-detail-screen" class="app-screen">
                    <div class="app-header">
                        <button class="back-button" onclick="hideApp('photo-detail-screen')">‚Äπ</button>
                        <div class="app-title">ÁÖßÁâá</div>
                    </div>
                    <div class="app-content" style="padding: 0; display: flex; flex-direction: column;">
                        <div class="photo-detail">
                            <div class="photo-image" id="photo-image">
                                <div class="photo-description" id="photo-description-text"></div>
                            </div>
                            <div class="photo-info">
                                <div class="photo-time" id="photo-time"></div>
                                <div class="photo-location" id="photo-location"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ChatËÆæÁΩÆ -->
                <div id="chat-settings-screen" class="app-screen">
                    <div class="app-header">
                        <button class="back-button" onclick="hideApp('chat-settings-screen')">‚Äπ</button>
                        <div class="app-title">ChatËÆæÁΩÆ</div>
                    </div>
                    <div class="app-content">
                        <div class="settings-item" onclick="changeChatThemeColor()">
                            <div class="settings-item-left">
                                <div class="settings-icon" style="background-color: #007AFF;">
                                    <i class="fas fa-palette"></i>
                                </div>
                                <div>ËÅäÂ§©‰∏ªÈ¢òÈ¢úËâ≤</div>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </div>
                </div>
                
                <!-- ËÆæÁΩÆÂ∫îÁî® -->
                <div id="settings-screen" class="app-screen">
                    <div class="app-status-bar">
                        <div class="app-status-time"></div>
                        <div class="app-battery-container">
                            <span class="battery-text">‚ô°</span>
                            <div class="app-battery-icon">
                                <div class="app-battery-level"></div>
                            </div>
                        </div>
                    </div>
                    <div class="app-header">
                        <button class="back-button" onclick="hideApp('settings-screen')">‚Äπ</button>
                        <div class="app-title">ËÆæÁΩÆ</div>
                    </div>
                    <div class="app-content">
                        <div class="settings-item" onclick="showApp('api-settings-screen')">
                            <div class="settings-item-left">
                                <div class="settings-icon wifi">
                                    <i class="fas fa-wifi"></i>
                                </div>
                                <div>APIËÆæÁΩÆ</div>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="settings-item" onclick="showApp('theme-screen')">
                            <div class="settings-item-left">
                                <div class="settings-icon" style="background-color: #FF69B4;">
                                    <i class="fas fa-palette"></i>
                                </div>
                                <div>‰∏ªÈ¢òËÆæÁΩÆ</div>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="settings-item">
                            <div class="settings-item-left">
                                <div class="settings-icon display">
                                    <i class="fas fa-sun"></i>
                                </div>
                                <div>ÊòæÁ§∫‰∏é‰∫ÆÂ∫¶</div>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="settings-item" onclick="showApp('wallpaper-screen')">
                            <div class="settings-item-left">
                                <div class="settings-icon wallpaper">
                                    <i class="fas fa-image"></i>
                                </div>
                                <div>Â¢ôÁ∫∏</div>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="settings-item" onclick="showApp('datetime-screen')">
                            <div class="settings-item-left">
                                <div class="settings-icon datetime">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <div>Êó•Êúü‰∏éÊó∂Èó¥</div>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="settings-item">
                            <div class="settings-item-left">
                                <div class="settings-icon notification">
                                    <i class="fas fa-bell"></i>
                                </div>
                                <div>ÈÄöÁü•</div>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="settings-item" onclick="showApp('about-screen')">
                            <div class="settings-item-left">
                                <div class="settings-icon about">
                                    <i class="fas fa-info-circle"></i>
                                </div>
                                <div>ÂÖ≥‰∫éÊàë‰ª¨</div>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </div>
                </div>
                
                <!-- Êó•Êúü‰∏éÊó∂Èó¥ËÆæÁΩÆ -->
                <div id="datetime-screen" class="app-screen">
                    <div class="app-header">
                        <button class="back-button" onclick="hideApp('datetime-screen')">‚Äπ</button>
                        <div class="app-title">Êó•Êúü‰∏éÊó∂Èó¥</div>
                    </div>
                    <div class="app-content">
                        <div class="settings-item">
                            <div class="settings-item-left">
                                <div>Ëá™Âä®ËÆæÁΩÆ</div>
                            </div>
                            <label class="settings-toggle">
                                <input type="checkbox" checked>
                                <span class="settings-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- ÂÖ≥‰∫éÊàë‰ª¨ -->
                <div id="about-screen" class="app-screen">
                    <div class="app-header">
                        <button class="back-button" onclick="hideApp('about-screen')">‚Äπ</button>
                        <div class="app-title">ÂÖ≥‰∫éÊàë‰ª¨</div>
                    </div>
                    <div class="app-content">
                        <div class="about-content">
                            <div class="about-title">iPhone Ê®°ÊãüÂô®</div>
                            <div class="about-version">ÁâàÊú¨ 1.0.0</div>
                            <div class="about-author">‰ΩúËÄÖ@EVE</div>
                        </div>
                    </div>
                </div>
                
                <!-- ‰∏ªÈ¢òËÆæÁΩÆÁïåÈù¢ -->
                <div id="theme-screen" class="app-screen">
                    <div class="app-status-bar">
                        <div class="app-status-time"></div>
                        <div class="app-battery-container">
                            <span class="battery-text">‚ô°</span>
                            <div class="app-battery-icon">
                                <div class="app-battery-level"></div>
                            </div>
                        </div>
                    </div>
                    <div class="app-header">
                        <button class="back-button" onclick="hideApp('theme-screen')">‚Äπ</button>
                        <div class="app-title">‰∏ªÈ¢òËÆæÁΩÆ</div>
                    </div>
                    <div class="app-content">
                        <div class="theme-option" onclick="changeTheme('default')">
                            <div class="theme-preview" style="background: linear-gradient(135deg, #f7f7f7, #e8e8e8);">
                                <div class="theme-preview-header"></div>
                                <div class="theme-preview-content"></div>
                            </div>
                            <div class="theme-info">
                                <div class="theme-name">ÁÆÄÁ∫¶È£éÊ†º</div>
                                <div class="theme-description">Ê∏ÖÊñ∞ÁÆÄÊ¥ÅÁöÑÈªòËÆ§‰∏ªÈ¢ò</div>
                            </div>
                        </div>
                        
                        <div class="theme-option" onclick="changeTheme('cute')">
                            <div class="theme-preview" style="background: linear-gradient(135deg, #ffe6f0, #ffb6c1);">
                                <div class="theme-preview-header"></div>
                                <div class="theme-preview-content"></div>
                            </div>
                            <div class="theme-info">
                                <div class="theme-name">ÂèØÁà±È£éÊ†º</div>
                                <div class="theme-description">Ê∏©È¶®ÂèØÁà±ÁöÑÁ≤âËâ≤‰∏ªÈ¢ò</div>
                            </div>
                        </div>
                        
                        <div class="theme-option" onclick="changeTheme('nature')">
                            <div class="theme-preview" style="background: linear-gradient(135deg, #c8e6c9, #a5d6a7);">
                                <div class="theme-preview-header"></div>
                                <div class="theme-preview-content"></div>
                            </div>
                            <div class="theme-info">
                                <div class="theme-name">Ëá™ÁÑ∂È£éÊ†º</div>
                                <div class="theme-description">Ê∏ÖÊñ∞Ëá™ÁÑ∂ÁöÑÁªøËâ≤‰∏ªÈ¢ò</div>
                            </div>
                        </div>
                        
                        <div class="theme-option" onclick="changeTheme('tech')">
                            <div class="theme-preview" style="background: linear-gradient(135deg, #b3e5fc, #81d4fa);">
                                <div class="theme-preview-header"></div>
                                <div class="theme-preview-content"></div>
                            </div>
                            <div class="theme-info">
                                <div class="theme-name">ÁßëÊäÄÈ£éÊ†º</div>
                                <div class="theme-description">Áé∞‰ª£ÁßëÊäÄÁöÑËìùËâ≤‰∏ªÈ¢ò</div>
                            </div>
                        </div>
                        
                        <div class="theme-option" onclick="changeTheme('dream')">
                            <div class="theme-preview" style="background: linear-gradient(135deg, #e1bee7, #ce93d8);">
                                <div class="theme-preview-header"></div>
                                <div class="theme-preview-content"></div>
                            </div>
                            <div class="theme-info">
                                <div class="theme-name">Ê¢¶ÂπªÈ£éÊ†º</div>
                                <div class="theme-description">Á•ûÁßòÊµ™Êº´ÁöÑÁ¥´Ëâ≤‰∏ªÈ¢ò</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Â¢ôÁ∫∏ËÆæÁΩÆ -->
                <div id="wallpaper-screen" class="app-screen">
                    <div class="app-header">
                        <button class="back-button" onclick="hideApp('wallpaper-screen')">‚Äπ</button>
                        <div class="app-title">Â¢ôÁ∫∏</div>
                    </div>
                    <div class="app-content">
                        <div class="settings-item" onclick="showWallpaperPicker()">
                            <div class="settings-item-left">
                                <div>ÈÄâÊã©Êñ∞Â¢ôÁ∫∏</div>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="settings-item" onclick="showIconPicker()">
                            <div class="settings-item-left">
                                <div>Êõ¥ÊîπÂ∫îÁî®ÂõæÊ†á</div>
                            </div>
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </div>
                </div>
                
                <!-- Êó†Á∫øÂ±ÄÂüüÁΩëËÆæÁΩÆ -->
                <div id="wifi-screen" class="app-screen">
                    <div class="app-header">
                        <button class="back-button" onclick="hideApp('wifi-screen')">‚Äπ</button>
                        <div class="app-title">Êó†Á∫øÂ±ÄÂüüÁΩë</div>
                    </div>
                    <div class="app-content">
                        <div class="wifi-settings">
                            <div class="settings-item">
                                <div class="settings-item-left">
                                    <div>Êó†Á∫øÂ±ÄÂüüÁΩë</div>
                                </div>
                                <label class="settings-toggle">
                                    <input type="checkbox" checked>
                                    <span class="settings-slider"></span>
                                </label>
                            </div>
                            
                            <div class="wifi-network">
                                <div class="wifi-network-left">
                                    <div class="wifi-icon">
                                        <i class="fas fa-lock"></i>
                                    </div>
                                    <div>
                                        <div>HomeWiFi</div>
                                        <div class="wifi-strength">
                                            <div class="wifi-strength-bar active"></div>
                                            <div class="wifi-strength-bar active"></div>
                                            <div class="wifi-strength-bar active"></div>
                                            <div class="wifi-strength-bar active"></div>
                                        </div>
                                    </div>
                                </div>
                                <i class="fas fa-check" style="color: #007AFF;"></i>
                            </div>
                            
                            <div class="settings-item" style="margin-top: 20px;" onclick="showApp('api-settings-screen')">
                                <div class="settings-item-left">
                                    <div>APIËÆæÁΩÆ</div>
                                </div>
                                <i class="fas fa-chevron-right"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- APIËÆæÁΩÆÁïåÈù¢ -->
                <div id="api-settings-screen" class="app-screen">
                    <div class="app-header">
                        <button class="back-button" onclick="hideApp('api-settings-screen')">‚Äπ</button>
                        <div class="app-title">APIËÆæÁΩÆ</div>
                    </div>
                    <div class="app-content">
                        <div class="api-settings">
                            <div class="api-form-group">
                                <label class="api-form-label">APIÁ±ªÂûã</label>
                                <select class="api-form-select" id="api-type">
                                    <option value="openai">OpenAI</option>
                                    <option value="azure">Azure OpenAI</option>
                                    <option value="anthropic">Anthropic</option>
                                    <option value="gemini">Google Gemini</option>
                                </select>
                            </div>
                            
                            <div class="api-form-group">
                                <label class="api-form-label">APIÂü∫Âú∞ÂùÄ</label>
                                <input type="text" class="api-form-input" id="api-base" placeholder="https://api.openai.com/v1">
                            </div>
                            
                            <div class="api-form-group">
                                <label class="api-form-label">Á´ØÁÇπË∑ØÂæÑ</label>
                                <input type="text" class="api-form-input" id="api-endpoint" placeholder="/chat/completions">
                            </div>
                            
                            <div class="api-form-group">
                                <label class="api-form-label">APIÁßòÈí•</label>
                                <input type="password" class="api-form-input" id="api-key" placeholder="sk-xxxxxxxxxxxxxxxx">
                            </div>
                            
                            <div class="api-form-group">
                                <label class="api-form-label">Ê®°ÂûãÂêçÁß∞</label>
                                <input type="text" class="api-form-input" id="api-model" placeholder="gpt-3.5-turbo">
                            </div>
                            
                            <div class="api-form-group">
                                <label class="api-form-label">Ê∏©Â∫¶ (0-1)</label>
                                <input type="range" class="api-form-range" id="api-temperature" min="0" max="1" step="0.1" value="0.7">
                                <span id="temperature-value">0.7</span>
                            </div>
                            
                            <div class="api-form-group">
                                <label class="api-form-label">ÊúÄÂ§ß‰∏ä‰∏ãÊñáÈïøÂ∫¶</label>
                                <input type="number" class="api-form-input" id="api-max-tokens" placeholder="2048" value="2048">
                            </div>
                            
                            <button class="api-form-submit" onclick="saveApiSettings()">‰øùÂ≠òËÆæÁΩÆ</button>
                        </div>
                    </div>
                </div>
                
                <!-- È¢úËâ≤ÈÄâÊã©Âô®Ê®°ÊÄÅÊ°Ü -->
                <div class="modal" id="color-picker-modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <div class="modal-title" id="color-picker-title">ÈÄâÊã©È¢úËâ≤</div>
                            <button class="modal-close" onclick="hideModal('color-picker-modal')">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="color-picker" id="color-picker">
                                <div class="color-option" style="background-color: #FF3B30;" onclick="selectColor('#FF3B30')"></div>
                                <div class="color-option" style="background-color: #FF9500;" onclick="selectColor('#FF9500')"></div>
                                <div class="color-option" style="background-color: #FFCC00;" onclick="selectColor('#FFCC00')"></div>
                                <div class="color-option" style="background-color: #34C759;" onclick="selectColor('#34C759')"></div>
                                <div class="color-option" style="background-color: #5AC8FA;" onclick="selectColor('#5AC8FA')"></div>
                                <div class="color-option" style="background-color: #007AFF;" onclick="selectColor('#007AFF')"></div>
                                <div class="color-option" style="background-color: #5856D6;" onclick="selectColor('#5856D6')"></div>
                                <div class="color-option" style="background-color: #AF52DE;" onclick="selectColor('#AF52DE')"></div>
                                <div class="color-option" style="background-color: #FF2D55;" onclick="selectColor('#FF2D55')"></div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">ÈÄèÊòéÂ∫¶</label>
                                <input type="range" class="opacity-slider" id="opacity-slider" min="0" max="1" step="0.1" value="1">
                                <span id="opacity-value">100%</span>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="modal-button modal-secondary" onclick="hideModal('color-picker-modal')">ÂèñÊ∂à</button>
                            <button class="modal-button modal-primary" onclick="applyColorSelection()">Â∫îÁî®</button>
                        </div>
                    </div>
                </div>
                
                <!-- Â¢ôÁ∫∏ÈÄâÊã©Âô®Ê®°ÊÄÅÊ°Ü -->
                <div class="modal" id="wallpaper-picker-modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <div class="modal-title">ÈÄâÊã©Â¢ôÁ∫∏</div>
                            <button class="modal-close" onclick="hideModal('wallpaper-picker-modal')">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="wallpaper-options">
                                <div class="wallpaper-option" style="background-image: linear-gradient(135deg, #6e8efb, #a777e3);" onclick="selectWallpaper('gradient1')"></div>
                                <div class="wallpaper-option" style="background-image: linear-gradient(135deg, #FF9A9E, #FAD0C4);" onclick="selectWallpaper('gradient2')"></div>
                                <div class="wallpaper-option" style="background-image: linear-gradient(135deg, #A1C4FD, #C2E9FB);" onclick="selectWallpaper('gradient3')"></div>
                                <div class="wallpaper-option" style="background-image: linear-gradient(135deg, #FFECD2, #FCB69F);" onclick="selectWallpaper('gradient4')"></div>
                            </div>
                            <div class="settings-item" style="margin-top: 15px;" onclick="uploadCustomWallpaper()">
                                <div class="settings-item-left">
                                    <div>‰ªéÁõ∏ÂÜåÈÄâÊã©</div>
                                </div>
                                <i class="fas fa-chevron-right"></i>
                            </div>
                            <input type="file" id="custom-wallpaper-upload" accept="image/*" style="display: none;">
                        </div>
                        <div class="modal-footer">
                            <button class="modal-button modal-secondary" onclick="hideModal('wallpaper-picker-modal')">ÂèñÊ∂à</button>
                            <button class="modal-button modal-primary" onclick="applyWallpaperSelection()">Â∫îÁî®</button>
                        </div>
                    </div>
                </div>
                
                <!-- ÂõæÊ†áÈÄâÊã©Âô®Ê®°ÊÄÅÊ°Ü -->
                <div class="modal" id="icon-picker-modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <div class="modal-title">ÈÄâÊã©Â∫îÁî®ÂõæÊ†á</div>
                            <button class="modal-close" onclick="hideModal('icon-picker-modal')">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="icon-options">
                                <div class="icon-option" onclick="selectAppIcon('chat-screen', 'fas fa-comment-dots')">
                                    <div class="icon-preview">
                                        <i class="fas fa-comment-dots"></i>
                                    </div>
                                    <span>Chat</span>
                                </div>
                                <div class="icon-option" onclick="selectAppIcon('weibo-screen', 'fab fa-weibo')">
                                    <div class="icon-preview">
                                        <i class="fab fa-weibo"></i>
                                    </div>
                                    <span>ÂæÆÂçö</span>
                                </div>
                                <div class="icon-option" onclick="selectAppIcon('music-screen', 'fas fa-music')">
                                    <div class="icon-preview">
                                        <i class="fas fa-music"></i>
                                    </div>
                                    <span>Èü≥‰πê</span>
                                </div>
                                <div class="icon-option" onclick="selectAppIcon('album-screen', 'fas fa-images')">
                                    <div class="icon-preview">
                                        <i class="fas fa-images"></i>
                                    </div>
                                    <span>Áõ∏ÂÜå</span>
                                </div>
                            </div>
                            <div class="settings-item" style="margin-top: 15px;" onclick="uploadCustomIcon()">
                                <div class="settings-item-left">
                                    <div>‰ªéÁõ∏ÂÜåÈÄâÊã©</div>
                                </div>
                                <i class="fas fa-chevron-right"></i>
                            </div>
                            <input type="file" id="custom-icon-upload" accept="image/*" style="display: none;">
                        </div>
                        <div class="modal-footer">
                            <button class="modal-button modal-secondary" onclick="hideModal('icon-picker-modal')">ÂèñÊ∂à</button>
                            <button class="modal-button modal-primary" onclick="applyIconSelection()">Â∫îÁî®</button>
                        </div>
                    </div>
                </div>
                
                <!-- ÁÖßÁâáÊãçÊëÑÊ®°ÊÄÅÊ°Ü -->
                <div class="modal" id="photo-capture-modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <div class="modal-title">ÁÖßÁâáËØ¶ÊÉÖ</div>
                            <button class="modal-close" onclick="hideModal('photo-capture-modal')">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label class="form-label">ÁÖßÁâáÊèèËø∞</label>
                                <input type="text" class="form-input" id="photo-description" placeholder="ÊèèËø∞ÊãçÊëÑÁöÑÂÜÖÂÆπ">
                            </div>
                            <div class="form-group">
                                <label class="form-label">ÊãçÊëÑÂú∞ÁÇπ</label>
                                <input type="text" class="form-input" id="photo-location-input" placeholder="ËæìÂÖ•ÊãçÊëÑÂú∞ÁÇπ">
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="modal-button modal-secondary" onclick="cancelPhoto()">ÂèñÊ∂à</button>
                            <button class="modal-button modal-primary" onclick="savePhoto()">‰øùÂ≠ò</button>
                        </div>
                    </div>
                </div>
                
                <!-- Ê∂àÊÅØÊìç‰ΩúËèúÂçï -->
                <div class="modal" id="message-menu-modal">
                    <div class="modal-content">
                        <div class="modal-body">
                            <div class="message-menu">
                                <div class="message-menu-item" onclick="editMessage()">‰øÆÊîπ</div>
                                <div class="message-menu-item" onclick="deleteMessage()">Âà†Èô§</div>
                                <div class="message-menu-item" onclick="deleteMultipleMessages()">ÊâπÈáèÂà†Èô§</div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="modal-button modal-secondary" onclick="hideModal('message-menu-modal')">ÂèñÊ∂à</button>
                        </div>
                    </div>
                </div>
                
                <!-- Ê∑ªÂä†ËÅîÁ≥ª‰∫∫Ê®°ÊÄÅÊ°Ü -->
                <div class="modal" id="add-contact-modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <div class="modal-title">Ê∑ªÂä†ËÅîÁ≥ª‰∫∫</div>
                            <button class="modal-close" onclick="hideModal('add-contact-modal')">&times;</button>
                        </div>
                        <div class="modal-body" id="contact-modal-body">
                            <!-- ËÅîÁ≥ª‰∫∫ÈÄâÈ°πÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÁîüÊàê -->
                        </div>
                        <div class="modal-footer">
                            <button class="modal-button modal-secondary" onclick="hideModal('add-contact-modal')">ÂèñÊ∂à</button>
                            <button class="modal-button modal-primary" onclick="addSelectedContacts()">Ê∑ªÂä†</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    <script>
        // ÂÖ®Â±ÄÂèòÈáè
        let characters = [];
        let contacts = [];
        let currentChatCharacter = null;
        let chatMessages = {};
        let selectedMessageId = null;
        let apiSettings = {
            type: 'openai',
            base: 'https://api.openai.com/v1',
            endpoint: '/chat/completions',
            key: '',
            model: 'gpt-3.5-turbo',
            temperature: 0.7,
            maxTokens: 2048
        };
        
        let chatSettings = {
            themeColor: '#007AFF',
            theirBubbleColor: '#f0f0f0',
            myBubbleColor: '#007AFF',
            bubbleOpacity: 1
        };
        
        let photos = [];
        let selectedAppIcon = null;
        let selectedWallpaper = null;
        let colorPickerContext = null;
        let customIconImage = null;
        
        // ÂàùÂßãÂåñÂ∫îÁî®
        document.addEventListener('DOMContentLoaded', function() {
            updateTime();
            loadCharacters();
            loadContacts();
            loadChatMessages();
            loadPhotos();
            loadChatSettings();
            loadWallpaper();
            loadAppIcons();
            loadApiSettings();
            loadSavedTheme();
            loadWorldbooks();
            loadMusicData();
            
            renderMessageList();
            renderContactList();
            renderCharacterList();
            renderAlbum();
            
            // Ê∏©Â∫¶ÊªëÂùóÊòæÁ§∫
            document.getElementById('api-temperature').addEventListener('input', function() {
                document.getElementById('temperature-value').textContent = this.value;
            });
            
            // ÈÄèÊòéÂ∫¶ÊªëÂùóÊòæÁ§∫
            document.getElementById('opacity-slider').addEventListener('input', function() {
                document.getElementById('opacity-value').textContent = Math.round(this.value * 100) + '%';
            });
            
            // ÊåâEnterÈîÆÂèëÈÄÅÊ∂àÊÅØ
            document.getElementById('api-chat-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendApiMessage();
                }
            });
            
            // Â§¥ÂÉè‰∏ä‰º†
            document.getElementById('avatar-upload').addEventListener('change', function(e) {
                if (e.target.files && e.target.files[0]) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        document.getElementById('avatar-preview').style.backgroundImage = `url(${event.target.result})`;
                        document.getElementById('avatar-preview-text').style.display = 'none';
                    };
                    reader.readAsDataURL(e.target.files[0]);
                }
            });
            
            // ÂõæÁâá‰∏ä‰º†
            document.getElementById('image-upload').addEventListener('change', function(e) {
                if (e.target.files && e.target.files[0]) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        sendImageMessage(event.target.result);
                    };
                    reader.readAsDataURL(e.target.files[0]);
                }
            });
            
            // Ëá™ÂÆö‰πâÂ¢ôÁ∫∏‰∏ä‰º†
            document.getElementById('custom-wallpaper-upload').addEventListener('change', function(e) {
                if (e.target.files && e.target.files[0]) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        selectedWallpaper = event.target.result;
                        // Á´ãÂç≥È¢ÑËßà
                        document.querySelector('.wallpaper').style.backgroundImage = `url(${selectedWallpaper})`;
                        document.querySelector('.wallpaper').style.backgroundSize = 'cover';
                        document.querySelector('.wallpaper').style.backgroundPosition = 'center';
                        // ‰∏çÂú®ËøôÈáå‰øùÂ≠òÔºåÁ≠âÁî®Êà∑ÁÇπÂáªÂ∫îÁî®Êó∂ÂÜç‰øùÂ≠ò
                    };
                    reader.readAsDataURL(e.target.files[0]);
                }
            });
            
            // Ëá™ÂÆö‰πâÂõæÊ†á‰∏ä‰º†
            document.getElementById('custom-icon-upload').addEventListener('change', function(e) {
                if (e.target.files && e.target.files[0]) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        customIconImage = event.target.result;
                        // Êõ¥Êñ∞È¢ÑËßà
                        const previews = document.querySelectorAll('.icon-preview');
                        previews.forEach(preview => {
                            preview.style.backgroundImage = `url(${customIconImage})`;
                            preview.innerHTML = ''; // ÁßªÈô§ÂõæÊ†á
                        });
                    };
                    reader.readAsDataURL(e.target.files[0]);
                }
            });
            
            setInterval(updateTime, 1000);
            initBatteryManager();
        });
        
        // ÊòæÁ§∫/ÈöêËóèÂ∫îÁî®
        function showApp(appId) {
            event.preventDefault();
            document.getElementById(appId).style.display = 'flex';
            
            // Â¶ÇÊûúÊòØËÅäÂ§©ÁïåÈù¢ÔºåÂà∑Êñ∞Ê∂àÊÅØÂàóË°®
            if (appId === 'chat-screen') {
                renderMessageList();
            }
            // Â¶ÇÊûúÊòØÁõ∏ÂÜåÁïåÈù¢ÔºåÂà∑Êñ∞Áõ∏ÂÜå
            else if (appId === 'album-screen') {
                renderAlbum();
            }
        }
        
        // ÊòæÁ§∫ËßíËâ≤ÂàõÂª∫Ë°®Âçï
        function showCharacterForm() {
            showApp('character-form-screen');
        }
        
        // ÈöêËóèËßíËâ≤ÂàõÂª∫Ë°®ÂçïÔºåËøîÂõûÂà∞chatÁïåÈù¢ÁöÑÈÄöËÆØÂΩï
        function hideCharacterForm() {
            hideApp('character-form-screen');
            showApp('chat-screen');
            switchWechatTab('contact-list');
            // ÊâãÂä®Ëß¶ÂèëÊ†áÁ≠æÂàáÊç¢ÁöÑÊ†∑Âºè
            document.querySelectorAll('.wechat-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.wechat-tab')[1].classList.add('active'); // ÈÄöËÆØÂΩïÊòØÁ¨¨‰∫å‰∏™Ê†áÁ≠æ
        }
        
        function hideApp(appId) {
            document.getElementById(appId).style.display = 'none';
        }
        
        // ÊòæÁ§∫/ÈöêËóèÊ®°ÊÄÅÊ°Ü
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
            
            // Â¶ÇÊûúÊòØÊ∑ªÂä†ËÅîÁ≥ª‰∫∫Ê®°ÊÄÅÊ°ÜÔºåÊ∏≤ÊüìÂèØÈÄâËÅîÁ≥ª‰∫∫
            if (modalId === 'add-contact-modal') {
                renderContactModal();
            }
        }
        
        function hideModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // ÂàáÊç¢ÂæÆ‰ø°Ê†áÁ≠æ
        function switchWechatTab(tabId) {
            // ÁßªÈô§ÊâÄÊúâÊ†áÁ≠æÁöÑactiveÁ±ª
            document.querySelectorAll('.wechat-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Ê∑ªÂä†ÂΩìÂâçÊ†áÁ≠æÁöÑactiveÁ±ª
            event.currentTarget.classList.add('active');
            
            // ÈöêËóèÊâÄÊúâÂÜÖÂÆπ
            document.getElementById('message-list').style.display = 'none';
            document.getElementById('contact-list').style.display = 'none';
            document.getElementById('moment-list').style.display = 'none';
            document.getElementById('profile-page').style.display = 'none';
            
            // ÊòæÁ§∫ÈÄâ‰∏≠ÁöÑÂÜÖÂÆπ
            document.getElementById(tabId).style.display = 'block';
            
            // ÊéßÂà∂Âä†Âè∑ÊåâÈíÆÊòæÁ§∫
            const addContactBtn = document.getElementById('add-contact-btn');
            if (tabId === 'contact-list') {
                addContactBtn.style.display = 'flex';
            } else {
                addContactBtn.style.display = 'none';
            }
        }
        
        // Êõ¥Êñ∞Êó∂Èó¥
        function updateTime() {
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const timeString = `${hours}:${minutes}`;
            
            // Êõ¥Êñ∞Áä∂ÊÄÅÊ†èÊó∂Èó¥
            const statusTime = document.getElementById('status-bar-time');
            if (statusTime) {
                statusTime.textContent = timeString;
            }
            
            // Êõ¥Êñ∞Â∫îÁî®ÂÜÖÁä∂ÊÄÅÊ†èÊó∂Èó¥
            const appStatusTimes = document.querySelectorAll('.app-status-time');
            appStatusTimes.forEach(element => {
                element.textContent = timeString;
            });
            
            // Êõ¥Êñ∞‰∏ªÊó∂Èíü
            const mainTime = document.getElementById('main-time');
            if (mainTime) {
                mainTime.textContent = timeString;
            }
            
            // Êõ¥Êñ∞Êó•Êúü
            const mainDate = document.getElementById('main-date');
            if (mainDate) {
                const date = now.toLocaleDateString('zh-CN', { 
                    month: 'long', 
                    day: 'numeric',
                    weekday: 'long'
                });
                mainDate.textContent = date;
            }
        }
        
        // Âä†ËΩΩËßíËâ≤Êï∞ÊçÆ
        function loadCharacters() {
            const savedCharacters = localStorage.getItem('characters');
            if (savedCharacters) {
                characters = JSON.parse(savedCharacters);
            } else {
                // ÈªòËÆ§ËßíËâ≤
                characters = [
                    {
                        id: '1',
                        name: 'Âº†‰∏â',
                        avatar: '',
                        avatarUrl: '',
                        bio: '‰∏Ä‰∏™ÂñúÊ¨¢ÊóÖË°åÁöÑÊëÑÂΩ±Â∏à',
                        color: '#FF9500'
                    },
                    {
                        id: '2',
                        name: 'ÊùéÂõõ',
                        avatar: '',
                        avatarUrl: '',
                        bio: 'ÁÉ≠Áà±ÁÉπÈ•™ÁöÑÁæéÈ£üÂÆ∂',
                        color: '#34C759'
                    }
                ];
                saveCharacters();
            }
        }
        
        // ‰øùÂ≠òËßíËâ≤Êï∞ÊçÆ
        function saveCharacters() {
            localStorage.setItem('characters', JSON.stringify(characters));
        }
        
        // Âä†ËΩΩËÅîÁ≥ª‰∫∫Êï∞ÊçÆ
        function loadContacts() {
            const savedContacts = localStorage.getItem('contacts');
            if (savedContacts) {
                contacts = JSON.parse(savedContacts);
            } else {
                // ÈªòËÆ§ËÅîÁ≥ª‰∫∫
                contacts = ['1', '2']; // ÈªòËÆ§Ê∑ªÂä†‰∏§‰∏™ËßíËâ≤‰Ωú‰∏∫ËÅîÁ≥ª‰∫∫
                saveContacts();
            }
        }
        
        // ‰øùÂ≠òËÅîÁ≥ª‰∫∫Êï∞ÊçÆ
        function saveContacts() {
            localStorage.setItem('contacts', JSON.stringify(contacts));
        }
        
        // Âä†ËΩΩËÅäÂ§©Ê∂àÊÅØ
        function loadChatMessages() {
            const savedMessages = localStorage.getItem('chatMessages');
            if (savedMessages) {
                chatMessages = JSON.parse(savedMessages);
            } else {
                chatMessages = {};
            }
        }
        
        // ‰øùÂ≠òËÅäÂ§©Ê∂àÊÅØ
        function saveChatMessages() {
            localStorage.setItem('chatMessages', JSON.stringify(chatMessages));
        }
        
        // Âä†ËΩΩÁÖßÁâá
        function loadPhotos() {
            const savedPhotos = localStorage.getItem('photos');
            if (savedPhotos) {
                photos = JSON.parse(savedPhotos);
            } else {
                photos = [];
            }
        }
        
        // ‰øùÂ≠òÁÖßÁâá
        function savePhotos() {
            localStorage.setItem('photos', JSON.stringify(photos));
        }
        
        // Âä†ËΩΩËÅäÂ§©ËÆæÁΩÆ
        function loadChatSettings() {
            const savedSettings = localStorage.getItem('chatSettings');
            if (savedSettings) {
                chatSettings = JSON.parse(savedSettings);
            }
        }
        
        // ‰øùÂ≠òËÅäÂ§©ËÆæÁΩÆ
        function saveChatSettings() {
            localStorage.setItem('chatSettings', JSON.stringify(chatSettings));
        }
        
        // Âä†ËΩΩÂ¢ôÁ∫∏
        function loadWallpaper() {
            const savedWallpaper = localStorage.getItem('wallpaper');
            const wallpaperType = localStorage.getItem('wallpaperType');
            
            if (savedWallpaper) {
                selectedWallpaper = savedWallpaper;
                
                if (wallpaperType === 'image' && savedWallpaper.startsWith('data:image')) {
                    // Âä†ËΩΩ‰∏ä‰º†ÁöÑÂõæÁâá
                    document.querySelector('.wallpaper').style.backgroundImage = `url(${savedWallpaper})`;
                } else if (wallpaperType === 'gradient' || savedWallpaper.startsWith('linear-gradient')) {
                    // Âä†ËΩΩÊ∏êÂèòËÉåÊôØ
                    document.querySelector('.wallpaper').style.backgroundImage = savedWallpaper;
                } else {
                    // Âä†ËΩΩÁ∫ØËâ≤ËÉåÊôØ
                    document.querySelector('.wallpaper').style.backgroundColor = savedWallpaper;
                    document.querySelector('.wallpaper').style.backgroundImage = 'none';
                }
                
                document.querySelector('.wallpaper').style.backgroundSize = 'cover';
                document.querySelector('.wallpaper').style.backgroundPosition = 'center';
            }
        }
        
        // Âä†ËΩΩÂ∫îÁî®ÂõæÊ†á
        function loadAppIcons() {
            const savedIcons = localStorage.getItem('appIcons');
            if (savedIcons) {
                const icons = JSON.parse(savedIcons);
                Object.keys(icons).forEach(appId => {
                    const iconElement = document.querySelector(`.app[onclick="showApp('${appId}')"] .app-icon i`);
                    if (iconElement) {
                        iconElement.className = icons[appId];
                    }
                });
            }
        }
        
        // Âä†ËΩΩAPIËÆæÁΩÆ
        function loadApiSettings() {
            const savedSettings = localStorage.getItem('apiSettings');
            if (savedSettings) {
                apiSettings = JSON.parse(savedSettings);
                
                // Êõ¥Êñ∞Ë°®ÂçïÊòæÁ§∫
                if (document.getElementById('api-type')) {
                    document.getElementById('api-type').value = apiSettings.type || 'openai';
                    document.getElementById('api-base').value = apiSettings.base || 'https://api.openai.com/v1';
                    document.getElementById('api-endpoint').value = apiSettings.endpoint || '/chat/completions';
                    document.getElementById('api-key').value = apiSettings.key || '';
                    document.getElementById('api-model').value = apiSettings.model || 'gpt-3.5-turbo';
                    document.getElementById('api-temperature').value = apiSettings.temperature || 0.7;
                    document.getElementById('api-max-tokens').value = apiSettings.maxTokens || 2048;
                    document.getElementById('temperature-value').textContent = apiSettings.temperature || 0.7;
                }
            }
        }
        
        // ‰øùÂ≠òÂ∫îÁî®ÂõæÊ†á
        function saveAppIcons() {
            const icons = {
                'chat-screen': 'fas fa-comment-dots',
                'weibo-screen': 'fab fa-weibo',
                'music-screen': 'fas fa-music',
                'album-screen': 'fas fa-images',
                'characters-screen': 'fas fa-user-friends',
                'shop-screen': 'fas fa-shopping-bag',
                'settings-screen': 'fas fa-cog'
            };
            
            if (selectedAppIcon) {
                icons[selectedAppIcon.appId] = selectedAppIcon.iconClass;
            }
            
            localStorage.setItem('appIcons', JSON.stringify(icons));
            
            // Âà∑Êñ∞ÂõæÊ†áÊòæÁ§∫
            loadAppIcons();
        }
        
        // Ê∏≤ÊüìÊ∂àÊÅØÂàóË°®
        function renderMessageList() {
            const messageList = document.getElementById('message-list');
            messageList.innerHTML = '';
            
            contacts.forEach(contactId => {
                const character = characters.find(c => c.id === contactId);
                if (character) {
                    const messages = chatMessages[character.id] || [];
                    const lastMessage = messages.length > 0 ? messages[messages.length - 1].content : 'ÊöÇÊó†Ê∂àÊÅØ';
                    const lastTime = messages.length > 0 ? formatTime(messages[messages.length - 1].timestamp) : 'ÂàöÂàö';
                    
                    const messageItem = document.createElement('div');
                    messageItem.className = 'message-item';
                    messageItem.onclick = () => startChat(character);
                    
                    messageItem.innerHTML = `
                        <div class="message-avatar" style="background-color: ${character.color}; ${character.avatarUrl ? `background-image: url(${character.avatarUrl})` : ''}">
                            ${character.avatarUrl ? '' : character.name.charAt(0)}
                        </div>
                        <div class="message-content">
                            <div class="message-name">${character.name}</div>
                            <div class="message-preview">${lastMessage}</div>
                        </div>
                        <div class="message-time">${lastTime}</div>
                    `;
                    
                    messageList.appendChild(messageItem);
                }
            });
        }
        
        // Ê∏≤ÊüìËÅîÁ≥ª‰∫∫ÂàóË°®
        function renderContactList() {
            const contactList = document.querySelector('#contact-list .contact-section');
            if (contactList) {
                // Ê∏ÖÁ©∫Áé∞ÊúâËÅîÁ≥ª‰∫∫Ôºå‰øùÁïô"Ê∑ªÂä†ËÅîÁ≥ª‰∫∫"ÊåâÈíÆ
                while (contactList.children.length > 1) {
                    contactList.removeChild(contactList.lastChild);
                }
                
                contacts.forEach(contactId => {
                    const character = characters.find(c => c.id === contactId);
                    if (character) {
                        const contactItem = document.createElement('div');
                        contactItem.className = 'contact-item';
                        contactItem.onclick = () => startChat(character);
                        
                        contactItem.innerHTML = `
                            <div class="message-avatar" style="background-color: ${character.color}; ${character.avatarUrl ? `background-image: url(${character.avatarUrl})` : ''}">
                                ${character.avatarUrl ? '' : character.name.charAt(0)}
                            </div>
                            <div class="message-name">${character.name}</div>
                        `;
                        
                        contactList.insertBefore(contactItem, contactList.lastChild);
                    }
                });
            }
        }
        
        // Ê∏≤ÊüìËßíËâ≤ÂàóË°®
        function renderCharacterList() {
            const characterList = document.getElementById('character-list');
            characterList.innerHTML = '';
            
            characters.forEach(character => {
                const characterItem = document.createElement('div');
                characterItem.className = 'character-item';
                characterItem.onclick = () => editCharacter(character.id);
                
                characterItem.innerHTML = `
                    <div class="character-avatar" style="background-color: ${character.color}; ${character.avatarUrl ? `background-image: url(${character.avatarUrl})` : ''}">
                        ${character.avatarUrl ? '' : character.name.charAt(0)}
                    </div>
                    <div class="character-info">
                        <div class="character-name">${character.name}</div>
                        <div class="character-bio">${character.bio}</div>
                    </div>
                `;
                
                characterList.appendChild(characterItem);
            });
        }
        
        // Ê∏≤ÊüìËÅîÁ≥ª‰∫∫Ê®°ÊÄÅÊ°Ü
        function renderContactModal() {
            const modalBody = document.getElementById('contact-modal-body');
            modalBody.innerHTML = '';
            
            characters.forEach(character => {
                // Âè™ÊòæÁ§∫Êú™Ê∑ªÂä†‰∏∫ËÅîÁ≥ª‰∫∫ÁöÑËßíËâ≤
                if (!contacts.includes(character.id)) {
                    const contactOption = document.createElement('div');
                    contactOption.className = 'contact-item';
                    
                    const checkboxId = `contact-${character.id}`;
                    
                    contactOption.innerHTML = `
                        <div class="message-avatar" style="background-color: ${character.color}; ${character.avatarUrl ? `background-image: url(${character.avatarUrl})` : ''}">
                            ${character.avatarUrl ? '' : character.name.charAt(0)}
                        </div>
                        <div class="character-info" style="flex: 1;">
                            <div class="character-name">${character.name}</div>
                            <div class="character-bio">${character.bio}</div>
                        </div>
                        <input type="checkbox" id="${checkboxId}" class="contact-checkbox" value="${character.id}">
                    `;
                    
                    modalBody.appendChild(contactOption);
                }
            });
            
            if (modalBody.children.length === 0) {
                modalBody.innerHTML = '<p>Ê≤°ÊúâÂèØÊ∑ªÂä†ÁöÑËßíËâ≤ÔºåËØ∑ÂÖàÂàõÂª∫Êñ∞ËßíËâ≤„ÄÇ</p>';
            }
        }
        
        // Ê∏≤ÊüìËÅäÂ§©Ê∂àÊÅØ
        function renderChatMessages(characterId) {
            const messagesContainer = document.getElementById('api-chat-messages');
            messagesContainer.innerHTML = '';
            
            const messages = chatMessages[characterId] || [];
            
            messages.forEach(message => {
                const messageContainer = document.createElement('div');
                messageContainer.className = `message-container ${message.sender}`;
                
                if (message.sender === 'received') {
                    const character = characters.find(c => c.id === characterId);
                    messageContainer.innerHTML = `
                        <div class="message-avatar" style="background-color: ${character.color}; ${character.avatarUrl ? `background-image: url(${character.avatarUrl})` : ''}">
                            ${character.avatarUrl ? '' : character.name.charAt(0)}
                        </div>
                        <div class="message-bubble" style="background-color: ${chatSettings.theirBubbleColor}; opacity: ${chatSettings.bubbleOpacity}">
                            ${message.content}
                            ${message.image ? `<img src="${message.image}" class="message-image" onclick="showImage('${message.image}')">` : ''}
                        </div>
                    `;
                } else {
                    messageContainer.innerHTML = `
                        <div class="message-bubble" style="background-color: ${chatSettings.myBubbleColor}; opacity: ${chatSettings.bubbleOpacity}">
                            ${message.content}
                            ${message.image ? `<img src="${message.image}" class="message-image" onclick="showImage('${message.image}')">` : ''}
                        </div>
                        <div class="message-avatar" style="background-color: #007AFF;">
                            <i class="fas fa-user"></i>
                        </div>
                    `;
                }
                
                messagesContainer.appendChild(messageContainer);
                
                // Ê∑ªÂä†Ê∂àÊÅØÁÇπÂáª‰∫ã‰ª∂
                const bubble = messageContainer.querySelector('.message-bubble');
                if (bubble) {
                    bubble.onclick = (e) => {
                        if (e.target.tagName !== 'IMG') {
                            showMessageMenu(message.id, e);
                        }
                    };
                }
            });
            
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        // Ê∏≤ÊüìÁõ∏ÂÜå
        function renderAlbum() {
            const albumGrid = document.getElementById('album-grid');
            albumGrid.innerHTML = '';
            
            photos.forEach(photo => {
                const albumItem = document.createElement('div');
                albumItem.className = 'album-item';
                albumItem.style.backgroundImage = `url(${photo.image})`;
                albumItem.setAttribute('data-description', photo.description);
                albumItem.setAttribute('data-time', formatFullDate(new Date(photo.timestamp)));
                albumItem.onclick = () => showPhotoDetail(photo);
                albumGrid.appendChild(albumItem);
            });
        }
        
        // ÊòæÁ§∫ËßíËâ≤Ë°®Âçï
        function showCharacterForm(characterId = null) {
            document.getElementById('character-form-title').textContent = characterId ? 'ÁºñËæë‰∫∫Áâ©' : 'Êñ∞Âª∫‰∫∫Áâ©';
            document.getElementById('character-name').value = '';
            document.getElementById('character-bio').value = '';
            
            const avatarPreview = document.getElementById('avatar-preview');
            const avatarPreviewText = document.getElementById('avatar-preview-text');
            
            // ÈáçÁΩÆÂ§¥ÂÉèÈ¢ÑËßà
            avatarPreview.style.backgroundImage = 'none';
            avatarPreviewText.style.display = 'block';
            avatarPreviewText.textContent = 'A';
            
            // Â¶ÇÊûúÊòØÁºñËæëÊ®°ÂºèÔºåÂ°´ÂÖÖÁé∞ÊúâÊï∞ÊçÆ
            if (characterId) {
                const character = characters.find(c => c.id === characterId);
                if (character) {
                    document.getElementById('character-name').value = character.name;
                    document.getElementById('character-bio').value = character.bio;
                    
                    if (character.avatarUrl) {
                        avatarPreview.style.backgroundImage = `url(${character.avatarUrl})`;
                        avatarPreviewText.style.display = 'none';
                    } else {
                        avatarPreviewText.textContent = character.name.charAt(0);
                    }
                }
            }
            
            // ËÆæÁΩÆË°®ÂçïÁöÑ‰øùÂ≠òÂáΩÊï∞
            document.querySelector('#character-form-screen .form-submit').onclick = characterId ? 
                () => saveCharacter(characterId) : saveCharacter;
            
            showApp('character-form-screen');
        }
        
        // ‰øùÂ≠òËßíËâ≤
        function saveCharacter(characterId = null) {
            const name = document.getElementById('character-name').value.trim();
            const bio = document.getElementById('character-bio').value.trim();
            const avatarFile = document.getElementById('avatar-upload').files[0];
            
            if (!name) {
                alert('ËØ∑ËæìÂÖ•ÂßìÂêç');
                return;
            }
            
            if (characterId) {
                // Êõ¥Êñ∞Áé∞ÊúâËßíËâ≤
                const index = characters.findIndex(c => c.id === characterId);
                if (index !== -1) {
                    if (avatarFile) {
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            characters[index] = {
                                ...characters[index],
                                name,
                                bio,
                                avatarUrl: event.target.result,
                                color: getRandomColor()
                            };
                            saveCharacters();
                            renderCharacterList();
                            renderContactList();
                            renderMessageList();
                            hideCharacterForm();
                        };
                        reader.readAsDataURL(avatarFile);
                    } else {
                        characters[index] = {
                            ...characters[index],
                            name,
                            bio,
                            color: getRandomColor()
                        };
                        saveCharacters();
                        renderCharacterList();
                        renderContactList();
                        renderMessageList();
                        hideCharacterForm();
                    }
                }
            } else {
                // ÂàõÂª∫Êñ∞ËßíËâ≤
                const newCharacter = {
                    id: Date.now().toString(),
                    name,
                    bio,
                    avatarUrl: '',
                    color: getRandomColor()
                };
                
                if (avatarFile) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        newCharacter.avatarUrl = event.target.result;
                        characters.push(newCharacter);
                        saveCharacters();
                        renderCharacterList();
                        renderContactList();
                        renderMessageList();
                        hideCharacterForm();
                    };
                    reader.readAsDataURL(avatarFile);
                } else {
                    characters.push(newCharacter);
                    saveCharacters();
                    renderCharacterList();
                    renderContactList();
                    renderMessageList();
                    hideCharacterForm();
                }
            }
        }
        
        // ÁºñËæëËßíËâ≤
        function editCharacter(characterId) {
            showCharacterForm(characterId);
        }
        
        // Ëé∑ÂèñÈöèÊú∫È¢úËâ≤
        function getRandomColor() {
            const colors = ['#FF3B30', '#FF9500', '#FFCC00', '#34C759', '#5AC8FA', '#007AFF', '#5856D6', '#AF52DE'];
            return colors[Math.floor(Math.random() * colors.length)];
        }
        
        // ÊòæÁ§∫Ê∑ªÂä†ËÅîÁ≥ª‰∫∫Ê®°ÊÄÅÊ°Ü
        function showAddContactModal() {
            showModal('add-contact-modal');
        }
        
        // Ê∑ªÂä†ÈÄâ‰∏≠ÁöÑËÅîÁ≥ª‰∫∫
        function addSelectedContacts() {
            const checkboxes = document.querySelectorAll('.contact-checkbox:checked');
            checkboxes.forEach(checkbox => {
                const characterId = checkbox.value;
                if (!contacts.includes(characterId)) {
                    contacts.push(characterId);
                }
            });
            
            saveContacts();
            renderMessageList();
            renderContactList();
            hideModal('add-contact-modal');
        }
        
        // ÂºÄÂßã‰∏éËßíËâ≤ËÅäÂ§©
        function startChat(character) {
            currentChatCharacter = character;
            document.getElementById('api-chat-title').textContent = character.name;
            
            if (!chatMessages[character.id]) {
                chatMessages[character.id] = [
                    {
                        id: Date.now().toString(),
                        sender: 'received',
                        content: `‰Ω†Â•ΩÔºÅÊàëÊòØ${character.name}Ôºå${character.bio}„ÄÇÊúâ‰ªÄ‰πàÊàëÂèØ‰ª•Â∏Æ‰Ω†ÁöÑÂêóÔºü`,
                        timestamp: Date.now()
                    }
                ];
                saveChatMessages();
            }
            
            renderChatMessages(character.id);
            showApp('api-chat-screen');
        }
        
        // ÂèëÈÄÅAPIÊ∂àÊÅØ
        async function sendApiMessage() {
            const input = document.getElementById('api-chat-input');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Ê∑ªÂä†Áî®Êà∑Ê∂àÊÅØ
            const messageId = Date.now().toString();
            const userMessage = {
                id: messageId,
                sender: 'sent',
                content: message,
                timestamp: Date.now()
            };
            
            if (!chatMessages[currentChatCharacter.id]) {
                chatMessages[currentChatCharacter.id] = [];
            }
            
            chatMessages[currentChatCharacter.id].push(userMessage);
            saveChatMessages();
            
            // Ê∏ÖÁ©∫ËæìÂÖ•Ê°Ü
            input.value = '';
            
            // Ê∏≤ÊüìÊ∂àÊÅØ
            renderChatMessages(currentChatCharacter.id);
            
            try {
                // Ë∞ÉÁî®API
                const response = await callChatAPI(message, currentChatCharacter);
                
                // Ê∑ªÂä†AIÂõûÂ§ç
                const aiMessage = {
                    id: Date.now().toString(),
                    sender: 'received',
                    content: response,
                    timestamp: Date.now()
                };
                
                chatMessages[currentChatCharacter.id].push(aiMessage);
                saveChatMessages();
                
                // Ê∏≤ÊüìÊ∂àÊÅØ
                renderChatMessages(currentChatCharacter.id);
            } catch (error) {
                console.error('APIË∞ÉÁî®Â§±Ë¥•:', error);
            }
        }
        
        // ÂèëÈÄÅÂõæÁâáÊ∂àÊÅØ
        function sendImageMessage(imageUrl) {
            const messageId = Date.now().toString();
            const imageMessage = {
                id: messageId,
                sender: 'sent',
                content: '',
                image: imageUrl,
                timestamp: Date.now()
            };
            
            if (!chatMessages[currentChatCharacter.id]) {
                chatMessages[currentChatCharacter.id] = [];
            }
            
            chatMessages[currentChatCharacter.id].push(imageMessage);
            saveChatMessages();
            
            // Ê∏≤ÊüìÊ∂àÊÅØ
            renderChatMessages(currentChatCharacter.id);
        }
        
        // Ë∞ÉÁî®ËÅäÂ§©API
        async function callChatAPI(message, character) {
            if (!apiSettings.key) {
                throw new Error('ËØ∑ÂÖàËÆæÁΩÆAPIÂØÜÈí•');
            }
            
            // ÊûÑÂª∫ËßíËâ≤ÊèêÁ§∫ËØç
            const characterPrompt = `‰Ω†Áé∞Âú®ÁöÑËßíËâ≤ÊòØ${character.name}Ôºå‰Ω†ÁöÑ‰∫∫ËÆæÊòØÔºö${character.bio}„ÄÇËØ∑‰ª•Ëøô‰∏™ËßíËâ≤ÁöÑË∫´‰ªΩÂíåÁî®Êà∑ÂØπËØù„ÄÇ`;
            
            const messages = [
                { role: 'system', content: characterPrompt },
                { role: 'user', content: message }
            ];
            
            const requestBody = {
                model: apiSettings.model,
                messages: messages,
                temperature: apiSettings.temperature,
                max_tokens: apiSettings.maxTokens
            };
            
            const url = apiSettings.base + apiSettings.endpoint;
            
            const response = await fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiSettings.key}`
                },
                body: JSON.stringify(requestBody)
            });
            
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error?.message || 'APIËØ∑Ê±ÇÂ§±Ë¥•');
            }
            
            const data = await response.json();
            return data.choices[0]?.message?.content || 'Ê≤°ÊúâÊî∂Âà∞ÂõûÂ§ç';
        }
        
        // ‰∏ä‰º†ÂõæÁâá
        function uploadImage() {
            document.getElementById('image-upload').click();
        }
        
        // ÊòæÁ§∫ÂõæÁâá
        function showImage(imageUrl) {
            const photo = photos.find(p => p.image === imageUrl);
            if (photo) {
                document.getElementById('photo-image').style.backgroundImage = `url(${imageUrl})`;
                document.getElementById('photo-description-text').textContent = photo.description;
                document.getElementById('photo-time').textContent = `ÊãçÊëÑ‰∫é: ${formatFullDate(new Date(photo.timestamp))}`;
                document.getElementById('photo-location').textContent = `Âú∞ÁÇπ: ${photo.location}`;
                showApp('photo-detail-screen');
            }
        }
        
        // ÂàáÊç¢ËÅäÂ§©ËèúÂçï
        function toggleChatMenu() {
            const menu = document.getElementById('chat-menu');
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        }
        
        // ‰øÆÊîπËßíËâ≤Â§¥ÂÉè
        function changeCharacterAvatar() {
            document.getElementById('avatar-upload').click();
            document.getElementById('avatar-upload').onchange = function(e) {
                if (e.target.files && e.target.files[0]) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        const characterIndex = characters.findIndex(c => c.id === currentChatCharacter.id);
                        if (characterIndex !== -1) {
                            characters[characterIndex].avatarUrl = event.target.result;
                            saveCharacters();
                            renderCharacterList();
                            renderContactList();
                            renderMessageList();
                            renderChatMessages(currentChatCharacter.id);
                        }
                    };
                    reader.readAsDataURL(e.target.files[0]);
                }
            };
        }
        
        // ‰øÆÊîπÂ§áÊ≥®
        function changeCharacterNickname() {
            const newName = prompt('ËØ∑ËæìÂÖ•Êñ∞ÁöÑÂ§áÊ≥®ÂêçÁß∞:', currentChatCharacter.name);
            if (newName && newName.trim() !== '') {
                const characterIndex = characters.findIndex(c => c.id === currentChatCharacter.id);
                if (characterIndex !== -1) {
                    characters[characterIndex].name = newName.trim();
                    saveCharacters();
                    document.getElementById('api-chat-title').textContent = newName.trim();
                    renderCharacterList();
                    renderContactList();
                    renderMessageList();
                }
            }
        }
        
        // Êü•ÊâæËÅäÂ§©ÂÜÖÂÆπ
        function searchChatContent() {
            const keyword = prompt('ËØ∑ËæìÂÖ•Ë¶ÅÊü•ÊâæÁöÑÂÖ≥ÈîÆËØç:');
            if (keyword && keyword.trim() !== '') {
                const messages = chatMessages[currentChatCharacter.id] || [];
                const foundMessages = messages.filter(msg => 
                    msg.content && msg.content.includes(keyword.trim())
                );
                
                if (foundMessages.length > 0) {
                    alert(`ÊâæÂà∞ ${foundMessages.length} Êù°ÂåÖÂê´"${keyword}"ÁöÑÊ∂àÊÅØ`);
                } else {
                    alert(`Ê≤°ÊúâÊâæÂà∞ÂåÖÂê´"${keyword}"ÁöÑÊ∂àÊÅØ`);
                }
            }
        }
        
        // ÁΩÆÈ°∂ËÅäÂ§©
        function pinChat() {
            // Âú®ÂÆûÈôÖÂ∫îÁî®‰∏≠ÔºåËøôÈáåÂèØ‰ª•ÂÆûÁé∞ÁΩÆÈ°∂ÂäüËÉΩ
            alert('ËÅäÂ§©Â∑≤ÁΩÆÈ°∂');
        }
        
        // ÂØºÂá∫ËÅäÂ§©ËÆ∞ÂΩï
        function exportChatHistory() {
            const messages = chatMessages[currentChatCharacter.id] || [];
            let history = `‰∏é ${currentChatCharacter.name} ÁöÑËÅäÂ§©ËÆ∞ÂΩï\n\n`;
            
            messages.forEach(msg => {
                const time = formatTime(msg.timestamp);
                const sender = msg.sender === 'sent' ? 'Êàë' : currentChatCharacter.name;
                history += `${time} ${sender}: ${msg.content}\n`;
            });
            
            // Âú®ÂÆûÈôÖÂ∫îÁî®‰∏≠ÔºåËøôÈáåÂèØ‰ª•ÂÆûÁé∞ÂØºÂá∫Êñá‰ª∂ÂäüËÉΩ
            console.log(history);
            alert('ËÅäÂ§©ËÆ∞ÂΩïÂ∑≤ÂØºÂá∫Âà∞ÊéßÂà∂Âè∞');
        }
        
        // ËÆæÁΩÆËÅäÂ§©ËÉåÊôØ
        function changeChatBackground() {
            showModal('wallpaper-picker-modal');
        }
        
        // ËÆæÁΩÆÂØπÊñπÊ∞îÊ≥°È¢úËâ≤
        function changeTheirBubbleColor() {
            colorPickerContext = 'theirBubble';
            document.getElementById('color-picker-title').textContent = 'ËÆæÁΩÆÂØπÊñπÊ∞îÊ≥°È¢úËâ≤';
            showModal('color-picker-modal');
        }
        
        // ËÆæÁΩÆÊàëÊñπÊ∞îÊ≥°È¢úËâ≤
        function changeMyBubbleColor() {
            colorPickerContext = 'myBubble';
            document.getElementById('color-picker-title').textContent = 'ËÆæÁΩÆÊàëÊñπÊ∞îÊ≥°È¢úËâ≤';
            showModal('color-picker-modal');
        }
        
        // ÈÄâÊã©È¢úËâ≤
        function selectColor(color) {
            document.querySelectorAll('.color-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.target.classList.add('selected');
            document.getElementById('selected-color').value = color;
        }
        
        // Â∫îÁî®È¢úËâ≤ÈÄâÊã©
        function applyColorSelection() {
            const selectedColor = document.querySelector('.color-option.selected')?.style.backgroundColor || '#007AFF';
            const opacity = document.getElementById('opacity-slider').value;
            
            if (colorPickerContext === 'theirBubble') {
                chatSettings.theirBubbleColor = selectedColor;
                chatSettings.bubbleOpacity = opacity;
            } else if (colorPickerContext === 'myBubble') {
                chatSettings.myBubbleColor = selectedColor;
                chatSettings.bubbleOpacity = opacity;
            }
            
            saveChatSettings();
            renderChatMessages(currentChatCharacter.id);
            hideModal('color-picker-modal');
        }
        
        // ÊòæÁ§∫Â¢ôÁ∫∏ÈÄâÊã©Âô®
        function showWallpaperPicker() {
            showModal('wallpaper-picker-modal');
        }
        
        // ÈÄâÊã©Â¢ôÁ∫∏
        function selectWallpaper(wallpaperId) {
            document.querySelectorAll('.wallpaper-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.target.classList.add('selected');
            
            // ËÆæÁΩÆÈÄâ‰∏≠ÁöÑÂ¢ôÁ∫∏
            selectedWallpaper = wallpaperId;
        }
        
        // Â∫îÁî®Â¢ôÁ∫∏ÈÄâÊã©
        function applyWallpaperSelection() {
            if (selectedWallpaper) {
                let wallpaperStyle = '';
                
                if (selectedWallpaper.startsWith('data:image')) {
                    // Â¶ÇÊûúÊòØ‰∏ä‰º†ÁöÑÂõæÁâá
                    wallpaperStyle = `url(${selectedWallpaper})`;
                    document.querySelector('.wallpaper').style.backgroundImage = wallpaperStyle;
                    document.querySelector('.wallpaper').style.backgroundSize = 'cover';
                    document.querySelector('.wallpaper').style.backgroundPosition = 'center';
                    localStorage.setItem('wallpaper', selectedWallpaper);
                    localStorage.setItem('wallpaperType', 'image');
                } else {
                    // Â¶ÇÊûúÊòØÈ¢ÑËÆæÊ∏êÂèò
                    switch (selectedWallpaper) {
                        case 'gradient1':
                            wallpaperStyle = 'linear-gradient(135deg, #6e8efb, #a777e3)';
                            break;
                        case 'gradient2':
                            wallpaperStyle = 'linear-gradient(135deg, #FF9A9E, #FAD0C4)';
                            break;
                        case 'gradient3':
                            wallpaperStyle = 'linear-gradient(135deg, #A1C4FD, #C2E9FB)';
                            break;
                        case 'gradient4':
                            wallpaperStyle = 'linear-gradient(135deg, #FFECD2, #FCB69F)';
                            break;
                        default:
                            wallpaperStyle = '#a8d4a8'; // ÈªòËÆ§È¢úËâ≤
                    }
                    
                    document.querySelector('.wallpaper').style.backgroundImage = wallpaperStyle;
                    document.querySelector('.wallpaper').style.backgroundSize = 'cover';
                    document.querySelector('.wallpaper').style.backgroundPosition = 'center';
                    localStorage.setItem('wallpaper', wallpaperStyle);
                    localStorage.setItem('wallpaperType', 'gradient');
                }
            }
            
            hideModal('wallpaper-picker-modal');
        }
        
        // ‰∏ä‰º†Ëá™ÂÆö‰πâÂ¢ôÁ∫∏
        function uploadCustomWallpaper() {
            document.getElementById('custom-wallpaper-upload').click();
        }
        
        // ÊòæÁ§∫ÂõæÊ†áÈÄâÊã©Âô®
        function showIconPicker() {
            showModal('icon-picker-modal');
        }
        
        // ÈÄâÊã©Â∫îÁî®ÂõæÊ†á
        function selectAppIcon(appId, iconClass) {
            selectedAppIcon = { appId, iconClass };
        }
        
        // ‰∏ä‰º†Ëá™ÂÆö‰πâÂõæÊ†á
        function uploadCustomIcon() {
            document.getElementById('custom-icon-upload').click();
        }
        
        // Â∫îÁî®ÂõæÊ†áÈÄâÊã©
        function applyIconSelection() {
            if (selectedAppIcon && customIconImage) {
                // Êõ¥Êñ∞Â∫îÁî®ÂõæÊ†á
                const appIcon = document.querySelector(`.app[onclick="showApp('${selectedAppIcon.appId}')"] .app-icon`);
                if (appIcon) {
                    appIcon.innerHTML = '';
                    appIcon.style.backgroundImage = `url(${customIconImage})`;
                    
                    // ‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®
                    let savedIcons = {};
                    try {
                        savedIcons = JSON.parse(localStorage.getItem('appIcons') || '{}');
                    } catch (error) {
                        console.error('Ëß£ÊûêÊú¨Âú∞Â≠òÂÇ®ÁöÑ appIcons Â§±Ë¥•:', error);
                        savedIcons = {};
                    }
                    savedIcons[selectedAppIcon.appId] = customIconImage;
                    localStorage.setItem('appIcons', JSON.stringify(savedIcons));
                }
            } else if (selectedAppIcon) {
                saveAppIcons();
            }
            hideModal('icon-picker-modal');
        }
        
        // Êõ¥ÊîπËÅäÂ§©‰∏ªÈ¢òÈ¢úËâ≤
        function changeChatThemeColor() {
            colorPickerContext = 'theme';
            document.getElementById('color-picker-title').textContent = 'ËÆæÁΩÆËÅäÂ§©‰∏ªÈ¢òÈ¢úËâ≤';
            showModal('color-picker-modal');
        }
        
        // ÊãçÁÖß
        function capturePhoto() {
            showModal('photo-capture-modal');
        }
        
        // ÂèñÊ∂àÁÖßÁâá
        function cancelPhoto() {
            hideModal('photo-capture-modal');
        }
        
        // ‰øùÂ≠òÁÖßÁâá
        function savePhoto() {
            const description = document.getElementById('photo-description').value.trim() || 'Êú™ÂëΩÂêçÁÖßÁâá';
            const location = document.getElementById('photo-location-input').value.trim() || 'Êú™Áü•Âú∞ÁÇπ';
            
            const now = new Date();
            const photo = {
                id: Date.now().toString(),
                image: 'https://via.placeholder.com/300', // Âú®ÂÆûÈôÖÂ∫îÁî®‰∏≠ÔºåËøôÈáåÂ∫îËØ•ÊòØÊãçÊëÑÁöÑÁÖßÁâá
                description,
                location,
                timestamp: now.toISOString(),
                timeString: formatTime(now.getTime()),
                locationString: location
            };
            
            photos.push(photo);
            savePhotos();
            renderAlbum();
            hideModal('photo-capture-modal');
        }
        
        // ÊòæÁ§∫ÁÖßÁâáËØ¶ÊÉÖ
        function showPhotoDetail(photo) {
            document.getElementById('photo-image').style.backgroundImage = `url(${photo.image})`;
            document.getElementById('photo-description-text').textContent = photo.description;
            document.getElementById('photo-time').textContent = `ÊãçÊëÑ‰∫é: ${formatFullDate(new Date(photo.timestamp))}`;
            document.getElementById('photo-location').textContent = `Âú∞ÁÇπ: ${photo.location}`;
            showApp('photo-detail-screen');
        }
        
        // ÊòæÁ§∫Ê∂àÊÅØËèúÂçï
        function showMessageMenu(messageId, event) {
            selectedMessageId = messageId;
            const menu = document.getElementById('message-menu-modal');
            menu.style.left = `${event.clientX - 100}px`;
            menu.style.top = `${event.clientY}px`;
            showModal('message-menu-modal');
        }
        
        // ÁºñËæëÊ∂àÊÅØ
        function editMessage() {
            if (!selectedMessageId) return;
            
            const messages = chatMessages[currentChatCharacter.id] || [];
            const messageIndex = messages.findIndex(msg => msg.id === selectedMessageId);
            
            if (messageIndex !== -1 && messages[messageIndex].sender === 'sent') {
                const newContent = prompt('ÁºñËæëÊ∂àÊÅØ:', messages[messageIndex].content);
                if (newContent !== null) {
                    messages[messageIndex].content = newContent;
                    saveChatMessages();
                    renderChatMessages(currentChatCharacter.id);
                }
            } else {
                alert('Âè™ËÉΩÁºñËæëËá™Â∑±ÂèëÈÄÅÁöÑÊ∂àÊÅØ');
            }
            
            hideModal('message-menu-modal');
        }
        
        // Âà†Èô§Ê∂àÊÅØ
        function deleteMessage() {
            if (!selectedMessageId) return;
            
            if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§ËøôÊù°Ê∂àÊÅØÂêóÔºü')) {
                const messages = chatMessages[currentChatCharacter.id] || [];
                const messageIndex = messages.findIndex(msg => msg.id === selectedMessageId);
                
                if (messageIndex !== -1) {
                    messages.splice(messageIndex, 1);
                    saveChatMessages();
                    renderChatMessages(currentChatCharacter.id);
                }
            }
            
            hideModal('message-menu-modal');
        }
        
        // ÊâπÈáèÂà†Èô§Ê∂àÊÅØ
        function deleteMultipleMessages() {
            const messages = chatMessages[currentChatCharacter.id] || [];
            const count = prompt('ËØ∑ËæìÂÖ•Ë¶ÅÂà†Èô§ÁöÑÊ∂àÊÅØÊï∞ÈáèÔºà‰ªéÊúÄÊñ∞ÂºÄÂßãÔºâ:', '1');
            
            if (count && !isNaN(count) && parseInt(count) > 0) {
                const numToDelete = Math.min(parseInt(count), messages.length);
                
                if (confirm(`Á°ÆÂÆöË¶ÅÂà†Èô§ÊúÄËøëÁöÑ ${numToDelete} Êù°Ê∂àÊÅØÂêóÔºü`)) {
                    messages.splice(-numToDelete, numToDelete);
                    saveChatMessages();
                    renderChatMessages(currentChatCharacter.id);
                }
            }
            
            hideModal('message-menu-modal');
        }
        
        // Ê†ºÂºèÂåñÊó∂Èó¥
        function formatTime(timestamp) {
            const date = new Date(timestamp);
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            return `${hours}:${minutes}`;
        }
        
        // Ê†ºÂºèÂåñÂÆåÊï¥Êó•Êúü
        function formatFullDate(date) {
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            return `${year}Âπ¥${month}Êúà${day}Êó• ${hours}:${minutes}`;
        }
        
        // Âä†ËΩΩURL
        function loadUrl() {
            const url = document.getElementById('browser-url').value;
            let fullUrl = url;
            
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                fullUrl = 'https://' + url;
            }
            
            document.getElementById('browser-frame').src = fullUrl;
        }
        
        // ‰øùÂ≠òAPIËÆæÁΩÆ
        function saveApiSettings() {
            apiSettings = {
                type: document.getElementById('api-type').value,
                base: document.getElementById('api-base').value,
                endpoint: document.getElementById('api-endpoint').value,
                key: document.getElementById('api-key').value,
                model: document.getElementById('api-model').value,
                temperature: parseFloat(document.getElementById('api-temperature').value),
                maxTokens: parseInt(document.getElementById('api-max-tokens').value)
            };
            
            localStorage.setItem('apiSettings', JSON.stringify(apiSettings));
            alert('APIËÆæÁΩÆÂ∑≤‰øùÂ≠ò');
            hideApp('api-settings-screen');
        }
        
        // ÁîµÊ±†ÁÆ°ÁêÜÂäüËÉΩ
        async function initBatteryManager() {
            // È¶ñÂÖàËÆæÁΩÆÈªòËÆ§ÊòæÁ§∫
            const allBatteryTexts = document.querySelectorAll('.battery-text');
            allBatteryTexts.forEach(element => {
                element.textContent = '‚ô°';
            });
            
            if ('getBattery' in navigator) {
                try {
                    const battery = await navigator.getBattery();
                    updateBatteryDisplay(battery);
                    
                    battery.addEventListener('levelchange', () => updateBatteryDisplay(battery));
                    battery.addEventListener('chargingchange', () => updateBatteryDisplay(battery));
                } catch (err) {
                    console.error("Êó†Ê≥ïËé∑ÂèñÁîµÊ±†‰ø°ÊÅØ:", err);
                    // ‰øùÊåÅÈªòËÆ§ÊòæÁ§∫ ·∞î·©ö
                }
            } else {
                console.log("ÊµèËßàÂô®‰∏çÊîØÊåÅÁîµÊ±†Áä∂ÊÄÅAPIÔºå‰ΩøÁî®ÈªòËÆ§ÊòæÁ§∫„ÄÇ");
                // ‰øùÊåÅÈªòËÆ§ÊòæÁ§∫ ·∞î·©ö
            }
        }
        
        function updateBatteryDisplay(battery) {
            const level = Math.floor(battery.level * 100);
            const isCharging = battery.charging;
            const symbol = isCharging ? 'üíñ' : '‚ô°';
            
            // Êõ¥Êñ∞‰∏ªÁä∂ÊÄÅÊ†èÁîµÊ±†
            const batteryContainer = document.getElementById('status-bar-battery');
            if (batteryContainer) {
                const batteryLevelEl = batteryContainer.querySelector('.battery-level');
                const batteryTextEl = batteryContainer.querySelector('.battery-text');
                
                if (batteryLevelEl && batteryTextEl) {
                    batteryLevelEl.style.width = `${level}%`;
                    batteryTextEl.textContent = symbol;
                    
                    if (isCharging) {
                        batteryContainer.classList.add('charging');
                    } else {
                        batteryContainer.classList.remove('charging');
                    }
                }
            }
            
            // Êõ¥Êñ∞Â∫îÁî®ÂÜÖÁä∂ÊÄÅÊ†èÁîµÊ±†
            const appBatteryContainers = document.querySelectorAll('.app-battery-container');
            const appBatteryTexts = document.querySelectorAll('.app-battery-container .battery-text');
            const appBatteryLevels = document.querySelectorAll('.app-battery-level');
            
            appBatteryTexts.forEach(element => {
                element.textContent = symbol;
            });
            
            appBatteryLevels.forEach(element => {
                element.style.width = `${level}%`;
            });
            
            // ÂêåÊ≠•Â∫îÁî®ÂÜÖÁîµÊ±†ÂÖÖÁîµÁä∂ÊÄÅ
            appBatteryContainers.forEach(container => {
                if (isCharging) {
                    container.classList.add('charging');
                } else {
                    container.classList.remove('charging');
                }
            });
        }
        
        // ‰∏ªÈ¢òÂàáÊç¢ÂäüËÉΩ
        function changeTheme(themeName) {
            const body = document.body;
            
            // ÁßªÈô§‰πãÂâçÁöÑ‰∏ªÈ¢ò
            body.removeAttribute('data-theme');
            
            // Â∫îÁî®Êñ∞‰∏ªÈ¢ò
            if (themeName !== 'default') {
                body.setAttribute('data-theme', themeName);
            }
            
            // ‰øùÂ≠ò‰∏ªÈ¢òËÆæÁΩÆ
            localStorage.setItem('selectedTheme', themeName);
            
            // ÁªôÁî®Êà∑ÂèçÈ¶à
            const themeNames = {
                'default': 'ÁÆÄÁ∫¶È£éÊ†º',
                'cute': 'ÂèØÁà±È£éÊ†º',
                'nature': 'Ëá™ÁÑ∂È£éÊ†º', 
                'tech': 'ÁßëÊäÄÈ£éÊ†º',
                'dream': 'Ê¢¶ÂπªÈ£éÊ†º'
            };
            
            // ÂèØ‰ª•Ê∑ªÂä†‰∏Ä‰∏™ÁÆÄÂçïÁöÑÊèêÁ§∫
            setTimeout(() => {
                alert(`Â∑≤ÂàáÊç¢Âà∞ ${themeNames[themeName]} ‰∏ªÈ¢ò`);
            }, 100);
        }
        
        // Âä†ËΩΩ‰øùÂ≠òÁöÑ‰∏ªÈ¢ò
        function loadSavedTheme() {
            const savedTheme = localStorage.getItem('selectedTheme');
            if (savedTheme && savedTheme !== 'default') {
                document.body.setAttribute('data-theme', savedTheme);
            }
        }
        
        // ‰∏ñÁïå‰π¶Áõ∏ÂÖ≥ÂäüËÉΩ
        let worldbooks = [];
        let editingWorldbook = null;
        
        function loadWorldbooks() {
            const savedWorldbooks = localStorage.getItem('worldbooks');
            if (savedWorldbooks) {
                try {
                    worldbooks = JSON.parse(savedWorldbooks);
                } catch (e) {
                    worldbooks = [];
                }
            }
            renderWorldbookList();
        }
        
        function saveWorldbooks() {
            localStorage.setItem('worldbooks', JSON.stringify(worldbooks));
        }
        
        function showWorldbookForm() {
            editingWorldbook = null;
            document.getElementById('worldbook-form-title').textContent = 'Êñ∞Âª∫‰∏ñÁïå‰π¶';
            document.getElementById('worldbook-title').value = '';
            document.getElementById('worldbook-content').value = '';
            showApp('worldbook-form-screen');
        }
        
        function hideWorldbookForm() {
            hideApp('worldbook-form-screen');
        }
        
        function saveWorldbook() {
            const title = document.getElementById('worldbook-title').value.trim();
            const content = document.getElementById('worldbook-content').value.trim();
            
            if (!title) {
                alert('ËØ∑ËæìÂÖ•‰∏ñÁïå‰π¶Ê†áÈ¢ò');
                return;
            }
            
            if (!content) {
                alert('ËØ∑ËæìÂÖ•‰∏ñÁïå‰π¶ÂÜÖÂÆπ');
                return;
            }
            
            const worldbook = {
                id: editingWorldbook ? editingWorldbook.id : Date.now().toString(),
                title: title,
                content: content,
                createdAt: editingWorldbook ? editingWorldbook.createdAt : new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            if (editingWorldbook) {
                const index = worldbooks.findIndex(w => w.id === editingWorldbook.id);
                if (index !== -1) {
                    worldbooks[index] = worldbook;
                }
            } else {
                worldbooks.push(worldbook);
            }
            
            saveWorldbooks();
            renderWorldbookList();
            hideWorldbookForm();
        }
        
        function editWorldbook(id) {
            const worldbook = worldbooks.find(w => w.id === id);
            if (worldbook) {
                editingWorldbook = worldbook;
                document.getElementById('worldbook-form-title').textContent = 'ÁºñËæë‰∏ñÁïå‰π¶';
                document.getElementById('worldbook-title').value = worldbook.title;
                document.getElementById('worldbook-content').value = worldbook.content;
                showApp('worldbook-form-screen');
            }
        }
        
        function deleteWorldbook(id) {
            if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™‰∏ñÁïå‰π¶ÂêóÔºü')) {
                worldbooks = worldbooks.filter(w => w.id !== id);
                saveWorldbooks();
                renderWorldbookList();
            }
        }
        
        function renderWorldbookList() {
            const listContainer = document.getElementById('worldbook-list');
            if (!listContainer) return;
            
            if (worldbooks.length === 0) {
                listContainer.innerHTML = '<div style="text-align: center; color: #666; padding: 40px;">ËøòÊ≤°Êúâ‰∏ñÁïå‰π¶ÔºåÁÇπÂáªÂè≥‰∏äËßí+Âè∑ÂàõÂª∫‰∏Ä‰∏™ÂêßÔºÅ</div>';
                return;
            }
            
            const html = worldbooks.map(worldbook => {
                const date = new Date(worldbook.updatedAt).toLocaleDateString();
                const preview = worldbook.content.substring(0, 100) + (worldbook.content.length > 100 ? '...' : '');
                
                return `
                    <div class="worldbook-item" style="padding: 15px; border-bottom: 1px solid #eee; cursor: pointer;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                            <div style="flex: 1;" onclick="editWorldbook('${worldbook.id}')">
                                <div style="font-weight: bold; font-size: 16px; margin-bottom: 5px;">${worldbook.title}</div>
                                <div style="color: #666; font-size: 14px; line-height: 1.4; margin-bottom: 8px;">${preview}</div>
                                <div style="color: #999; font-size: 12px;">Êõ¥Êñ∞‰∫é ${date}</div>
                            </div>
                            <button onclick="deleteWorldbook('${worldbook.id}')" style="background: none; border: none; color: #ff3b30; cursor: pointer; font-size: 16px; padding: 5px;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
            
            listContainer.innerHTML = html;
        }
        
        // Èü≥‰πêÂ∫îÁî®Áõ∏ÂÖ≥ÂäüËÉΩ
        let playlist = [];
        let currentSong = null;
        let isPlaying = false;
        let listeningCharacters = [];
        
        function loadMusicData() {
            const savedPlaylist = localStorage.getItem('musicPlaylist');
            if (savedPlaylist) {
                try {
                    playlist = JSON.parse(savedPlaylist);
                } catch (e) {
                    playlist = [];
                }
            }
            
            const savedListeners = localStorage.getItem('listeningCharacters');
            if (savedListeners) {
                try {
                    listeningCharacters = JSON.parse(savedListeners);
                } catch (e) {
                    listeningCharacters = [];
                }
            }
            
            renderPlaylist();
            renderListeningCharacters();
        }
        
        function saveMusicData() {
            localStorage.setItem('musicPlaylist', JSON.stringify(playlist));
            localStorage.setItem('listeningCharacters', JSON.stringify(listeningCharacters));
        }
        
        function addMusicToPlaylist() {
            const title = prompt('ËØ∑ËæìÂÖ•Ê≠åÊõ≤ÂêçÁß∞:');
            if (title && title.trim()) {
                const artist = prompt('ËØ∑ËæìÂÖ•Ëâ∫ÊúØÂÆ∂ÂêçÁß∞:') || 'Êú™Áü•Ëâ∫ÊúØÂÆ∂';
                const song = {
                    id: Date.now().toString(),
                    title: title.trim(),
                    artist: artist.trim(),
                    duration: '3:30' // Ê®°ÊãüÊó∂Èïø
                };
                
                playlist.push(song);
                saveMusicData();
                renderPlaylist();
            }
        }
        
        function playSong(songId) {
            const song = playlist.find(s => s.id === songId);
            if (song) {
                currentSong = song;
                document.getElementById('song-title').textContent = song.title;
                document.getElementById('artist-name').textContent = song.artist;
                document.getElementById('total-time').textContent = song.duration;
                
                // Êõ¥Êñ∞Êí≠ÊîæÊåâÈíÆ
                const playBtn = document.getElementById('play-pause-btn');
                playBtn.innerHTML = '<i class="fas fa-pause"></i>';
                isPlaying = true;
                
                // Ê®°ÊãüÊí≠ÊîæËøõÂ∫¶
                simulatePlayback();
                
                // ÈÄöÁü•Âê¨Ê≠åËßíËâ≤
                notifyListeningCharacters(song);
            }
        }
        
        function togglePlayPause() {
            const playBtn = document.getElementById('play-pause-btn');
            if (isPlaying) {
                playBtn.innerHTML = '<i class="fas fa-play"></i>';
                isPlaying = false;
            } else {
                if (currentSong) {
                    playBtn.innerHTML = '<i class="fas fa-pause"></i>';
                    isPlaying = true;
                    simulatePlayback();
                } else if (playlist.length > 0) {
                    playSong(playlist[0].id);
                }
            }
        }
        
        function previousSong() {
            if (!currentSong || playlist.length === 0) return;
            
            const currentIndex = playlist.findIndex(s => s.id === currentSong.id);
            const prevIndex = currentIndex > 0 ? currentIndex - 1 : playlist.length - 1;
            playSong(playlist[prevIndex].id);
        }
        
        function nextSong() {
            if (!currentSong || playlist.length === 0) return;
            
            const currentIndex = playlist.findIndex(s => s.id === currentSong.id);
            const nextIndex = currentIndex < playlist.length - 1 ? currentIndex + 1 : 0;
            playSong(playlist[nextIndex].id);
        }
        
        function simulatePlayback() {
            if (!isPlaying) return;
            
            // ËøôÈáåÂè™ÊòØÊ®°ÊãüËøõÂ∫¶ÔºåÂÆûÈôÖÂ∫îÁî®‰∏≠ÈúÄË¶ÅÁúüÂÆûÁöÑÈü≥È¢ëÊí≠Êîæ
            let progress = 0;
            const interval = setInterval(() => {
                if (!isPlaying) {
                    clearInterval(interval);
                    return;
                }
                
                progress += 1;
                document.getElementById('progress').style.width = `${Math.min(progress, 100)}%`;
                
                const currentMinutes = Math.floor(progress * 3.5 / 100);
                const currentSeconds = Math.floor((progress * 3.5 / 100 - currentMinutes) * 60);
                document.getElementById('current-time').textContent = 
                    `${currentMinutes}:${currentSeconds.toString().padStart(2, '0')}`;
                
                if (progress >= 100) {
                    clearInterval(interval);
                    nextSong();
                }
            }, 100);
        }
        
        function inviteCharacterToListen() {
            const availableCharacters = characters.filter(c => 
                !listeningCharacters.find(lc => lc.id === c.id)
            );
            
            if (availableCharacters.length === 0) {
                alert('Ê≤°ÊúâÂèØÈÇÄËØ∑ÁöÑËßíËâ≤‰∫ÜÔºåÊàñËÄÖÊâÄÊúâËßíËâ≤ÈÉΩÂ∑≤ÁªèÂú®Âê¨Ê≠å');
                return;
            }
            
            const characterNames = availableCharacters.map((c, index) => `${index + 1}. ${c.name}`).join('\n');
            const choice = prompt(`ÈÄâÊã©Ë¶ÅÈÇÄËØ∑ÁöÑËßíËâ≤:\n${characterNames}\n\nËØ∑ËæìÂÖ•Êï∞Â≠ó:`);
            
            if (choice && !isNaN(choice)) {
                const index = parseInt(choice) - 1;
                if (index >= 0 && index < availableCharacters.length) {
                    const character = availableCharacters[index];
                    listeningCharacters.push({
                        id: character.id,
                        name: character.name,
                        avatar: character.avatarUrl || character.name.charAt(0),
                        joinedAt: new Date().toISOString()
                    });
                    
                    saveMusicData();
                    renderListeningCharacters();
                    
                    // Ê®°ÊãüËßíËâ≤ÂìçÂ∫î
                    setTimeout(() => {
                        alert(`${character.name}: Â•ΩÁöÑÔºåÊàëÊù•Âíå‰Ω†‰∏ÄËµ∑Âê¨Ê≠åÔºÅ`);
                    }, 500);
                }
            }
        }
        
        function removeListeningCharacter(characterId) {
            listeningCharacters = listeningCharacters.filter(c => c.id !== characterId);
            saveMusicData();
            renderListeningCharacters();
        }
        
        function notifyListeningCharacters(song) {
            listeningCharacters.forEach(character => {
                // Ê®°ÊãüËßíËâ≤ÂØπÈü≥‰πêÁöÑÂèçÂ∫î
                const reactions = [
                    `${character.name}: ËøôÈ¶ñÊ≠åÁúüÂ•ΩÂê¨ÔºÅ`,
                    `${character.name}: Êàë‰πüÂæàÂñúÊ¨¢ËøôÈ¶ñ„Ää${song.title}„Äã`,
                    `${character.name}: Âê¨ÁùÄËøôÈü≥‰πêÂøÉÊÉÖÁúüÂ•ΩÔΩû`,
                    `${character.name}: Ë∞¢Ë∞¢ÂàÜ‰∫´Ëøô‰πàÊ£íÁöÑÈü≥‰πêÔºÅ`
                ];
                
                const reaction = reactions[Math.floor(Math.random() * reactions.length)];
                
                setTimeout(() => {
                    // ÂèØ‰ª•Âú®ËøôÈáåÊòæÁ§∫ËßíËâ≤ÁöÑÂèçÂ∫îÊ∂àÊÅØ
                    console.log(reaction);
                }, Math.random() * 3000 + 1000);
            });
        }
        
        function renderPlaylist() {
            const playlistContainer = document.getElementById('playlist');
            if (!playlistContainer) return;
            
            if (playlist.length === 0) {
                playlistContainer.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">Êí≠ÊîæÂàóË°®‰∏∫Á©∫ÔºåÁÇπÂáª+Âè∑Ê∑ªÂä†Èü≥‰πê</div>';
                return;
            }
            
            const html = playlist.map(song => `
                <div class="playlist-item" onclick="playSong('${song.id}')">
                    <div>
                        <div style="font-weight: 500;">${song.title}</div>
                        <div style="font-size: 12px; color: #666;">${song.artist}</div>
                    </div>
                    <div style="font-size: 12px; color: #999;">${song.duration}</div>
                </div>
            `).join('');
            
            playlistContainer.innerHTML = html;
        }
        
        function renderListeningCharacters() {
            const container = document.getElementById('listening-characters');
            if (!container) return;
            
            if (listeningCharacters.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">Ê≤°ÊúâËßíËâ≤Âú®Âê¨Ê≠åÔºåÁÇπÂáª+Âè∑ÈÇÄËØ∑ËßíËâ≤</div>';
                return;
            }
            
            const html = listeningCharacters.map(character => `
                <div class="character-item">
                    <div class="character-avatar" style="background-image: url(${character.avatar}); background-size: cover; background-position: center;">
                        ${character.avatar.startsWith('http') ? '' : character.name.charAt(0)}
                    </div>
                    <div class="character-name">${character.name}</div>
                    <div class="listening-status">Ê≠£Âú®Âê¨Ê≠å</div>
                    <button onclick="removeListeningCharacter('${character.id}')" style="background: none; border: none; color: #ff3b30; cursor: pointer; margin-left: 10px;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `).join('');
            
            container.innerHTML = html;
        }
    </script>
</body>
</html>